!function(){"use strict";function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function e(){}function i(t,e,i,n){this.x=t,this.y=e,this.time=0,this.width=i,this.height=n}function n(t,e){i.call(this,t,e,40,40),this.rangeOfMovement=4,this.maxLife=75,this.life=this.maxLife,this.move(0)}function o(t,e,n,o){i.call(this,t,e,40,10),this.invisPointY=o,this.speed=n}let r,s,a;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},t.prototype.union=function(t){var e,i,n,o;void 0!==t&&(e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=o)},e.prototype.animated=function(t,e,i,n,o,r,s,a){let h=document.createElement("img"),u=document.createElement("img");return h.addEventListener("error",function(){console.log("Image failed!")},!1),h.addEventListener("load",function(){let t=document.createElement("canvas"),o=t.getContext("2d");t.width=e*n,t.height=i,o.drawImage(h,a*e,s*i,e*n,i,0,0,e*n,i),u.src=t.toDataURL("image/png")},!1),h.src=t,this.frameWidth=e,this.frameHeight=i,this.row=s,this.col=a,this.frames=n,this.frameRate=o,this.timer=0,this.currentFrame=0,this.loopOnce=r,this.image=u,this},e.prototype.static=function(t,e,i,n,o){let r=document.createElement("img"),s=document.createElement("img");return r.addEventListener("error",function(){console.log("Image failed!")},!1),r.addEventListener("load",function(){let t=document.createElement("canvas"),a=t.getContext("2d");t.width=e,t.height=i,a.drawImage(r,o*e,n*i,e,i,0,0,e,i),s.src=t.toDataURL("image/png")},!1),r.src=t,this.frameWidth=e,this.frameHeight=i,this.row=n,this.col=o,this.frameRate=0,this.frames=0,this.currentFrame=0,this.image=s,this},e.prototype.update=function(t){0!==this.frameRate&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame,this.frames,this.currentFrame++,this.currentFrame>=this.frames&&!this.loopOnce&&(this.currentFrame=0)))},i.prototype.update=function(t){this.time+=t},i.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},i.prototype.collisionLine=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,1)},n.prototype=Object.create(i.prototype),n.prototype.update=function(t){i.prototype.update.call(this,t)},n.prototype.addLife=function(){this.life+=25,this.life>=this.maxLife&&(this.life=this.maxLife)},n.prototype.loseLife=function(){this.life-=25,this.life<=0&&s.setGameOver()},n.prototype.move=function(t){this.x=r.INITIAL_WIDTH()/this.rangeOfMovement*t+20},o.prototype=Object.create(i.prototype),o.prototype.update=function(t){i.prototype.update.call(this,t),this.y+=this.speed},a=function(){let t=[];return{update:function(e){let i,n=s.enemies(),o=s.player(),a=o.collisionLine();for(i=n.length-1;i>=0;i--){let e=n[i],s=e.collisionLine();e&&o&&s.intersects(a)?(o.addLife(),t.push(e)):e&&s.top()>r.INITIAL_HEIGHT()&&(t.push(e),o.loseLife())}},clearEntitiesToRemove:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},entitiesToRemove:function(){return t}}}(),r=function(){let t=(new e).animated("build/sprites/animals.png",26,36,3,6,!1,3,3),i=(new e).animated("build/sprites/explosion.png",223,174,22,22,!0,0,0),r=(new e).static("build/sprites/animals.png",26,36,4,7),a=(new e).static("build/sprites/grassland.png",128,128,4,6),h=[t],u=document.getElementById("gameWindow"),c=u.getContext("2d");const f=480,l=f/720;let d=720,m=f,p=navigator.userAgent.toLowerCase(),g=p.indexOf("android")>-1,y=p.indexOf("iphone")>-1||p.indexOf("ipad")>-1;function I(){d=window.innerHeight,m=d*l,(g||y)&&(document.body.style.height=window.innerHeight+50+"px"),u.style.width=m+"px",u.style.height=d+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function v(t,e,i,n,o){0===t.frameRate||t.loopOnce&&t.currentFrame>=t.frames?c.drawImage(t.image,t.frameWidth*t.frames,0,t.frameWidth,t.frameHeight,e,i,n,o):c.drawImage(t.image,t.frameWidth*t.currentFrame,0,t.frameWidth,t.frameHeight,e,i,n,o)}function w(t,e){v(e,t.x,t.y-t.height/2,1.5*t.width,1.5*t.height)}u.width=f,u.height=720,I(),window.addEventListener("resize",I,!1);let L=function(){let t=0;return function(){let e,i,n=f/64;for(e=0;e<=n;e++)for(i=-1;i<=11.25;i++)v(a,64*e,64*i+t,64,64);s.accelerating()&&!s.gameOver()&&(t+=6),t>=64&&(t=0)}}();return{render:function(e){let a,u,l=s.entities();if(L(),s.accelerating())for(u=h.length-1;u>=0;u--)h[u].update(e);for(u=0;u<l.length;u++)(a=l[u])instanceof o?(m=r,(d=a).y<d.invisPointY?v(m,d.x,d.y-d.height/2,1.5*d.width,6*d.height):(c.fillStyle="white",c.fillRect(0,d.y+d.height,f,10))):a instanceof n&&(s.gameOver()?(i.update(e),v(i,a.x,a.y-a.height/2,1.5*a.width,1.5*a.height)):w(a,t));var d,m},INITIAL_WIDTH:function(){return f},INITIAL_HEIGHT:function(){return 720},currentWidth:function(){return m},currentHeight:function(){return d},canvas:function(){return u}}}(),s=function(){let t,e,i,h,u,c,f,l=!1,d=!0,m=0,p=m,g=!1,y=function(){let t=0,e=2*r.INITIAL_HEIGHT();return function(){let i=r.INITIAL_WIDTH()/h.rangeOfMovement*(n=h.rangeOfMovement,Math.floor(Math.random()*Math.floor(n)))+20;var n;t++,console.log("wave "+t),4==t||5==t&&(e=r.INITIAL_HEIGHT()/2),e>=80&&(e-=10),w(new o(i,-10,p,e))}}();function I(){d=!d,console.log("input buffered: "+d)}function v(){let t;if(l){for(p=m,t=0;t<i.length;t++)i[t].speed=p;l=!1}else{for(p=6,t=0;t<i.length;t++)i[t].speed=p;l=!0}}function w(t){e.push(t),t instanceof n?h=t:t instanceof o&&i.push(t)}return{start:function(){if(console.log("game start"),console.log("input buffered: "+d),e=[],i=[],u=!1,c=0,f=[],t=0,"undefined"!=typeof Storage)try{f=JSON.parse(localStorage.sharkAttackScores)}catch(t){f=[]}this.addEntity(new n(0,r.INITIAL_HEIGHT()-60)),y(),g||(requestAnimationFrame(this.update.bind(this)),g=!0)},update:function(n){let s,c,f=[],m=!1,p=h.y-h.height,w=r.INITIAL_HEIGHT()/4,L=Math.min((n-t)/1e3,.05);if(t=n,u)return g=!1,r.render(L),void requestAnimationFrame(this.update.bind(this));for(a.update(L),c=0;c<e.length;c++)(s=e[c]).update(L),s instanceof o&&!m&&s.y>=w&&s.y<w+s.speed&&(y(),m=!0),s instanceof o&&l&&!d&&s.y>=p&&s.y<p+s.speed&&(v(),I()),a.entitiesToRemove().includes(s)&&(f.push(s),d&&I());!function(t){function n(e){return!t.includes(e)}t&&(e=e.filter(n),i=i.filter(n),t.includes(h)&&(h=void 0))}(f),a.clearEntitiesToRemove(),m=!1,r.render(L),requestAnimationFrame(this.update.bind(this))},addEntity:w,setGameOver:function(){var t;u||(console.log("game over"),u=!0,t=Math.round(s.score()),f.push(t),f.sort(function(t,e){return e-t}),f=f.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(f)))},addScore:function(t){c+=t},toggleAcceleration:v,toggleInputBuffer:I,accelerating:function(){return l},inputBuffered:function(){return d},score:function(){return c},highScores:function(){return f},gameOver:function(){return u},entities:function(){return e},enemies:function(){return i},player:function(){return h}}}();let h={49:0,50:1,51:2,52:3};function u(t){let e=r.currentWidth()/r.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==h[e]&&s.player()&&!s.gameOver()&&(t.preventDefault(),s.player().move(h[e]),s.accelerating()?s.inputBuffered()||s.toggleInputBuffer():s.toggleAcceleration())}),r.canvas().addEventListener("touchstart",function(t){let e,i,n=t.changedTouches;if(t.preventDefault(),!s.gameOver())for(let t=n.length-1;t>=0;t--)i=(e=u(n[t])).x<.25*r.INITIAL_WIDTH()?0:e.x<.5*r.INITIAL_WIDTH()?1:e.x<.75*r.INITIAL_WIDTH()?2:3,s.player().move(i),s.accelerating()?s.inputBuffered():s.toggleAcceleration(),s.toggleInputBuffer()}),s.start()}();