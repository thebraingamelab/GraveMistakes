!function(){"use strict";function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}function e(){}function n(t,e,n,i){this.x=t,this.y=e,this.time=0,this.width=n,this.height=i}function i(t,e){n.call(this,t,e,40,40),this.rangeOfMovement=4,this.energy=100,this.move(0)}function o(t,e,i,o){n.call(this,t,e,40,10),this.invisPointY=o,this.speed=i}let r,s,a;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},t.prototype.union=function(t){var e,n,i,o;void 0!==t&&(e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=n,this.width=i,this.height=o)},e.prototype.animated=function(t,e,n,i,o,r,s){let a=document.createElement("img"),h=document.createElement("img");return a.addEventListener("error",function(){console.log("Image failed!")},!1),a.addEventListener("load",function(){let t=document.createElement("canvas"),o=t.getContext("2d");t.width=e*i,t.height=n,o.drawImage(a,s*e,r*n,e*i,n,0,0,e*i,n),h.src=t.toDataURL("image/png")},!1),a.src=t,this.frameWidth=e,this.frameHeight=n,this.row=r,this.col=s,this.frames=i,this.frameRate=o,this.timer=0,this.currentFrame=0,this.image=h,this},e.prototype.static=function(t,e,n,i,o){let r=document.createElement("img"),s=document.createElement("img");return r.addEventListener("error",function(){console.log("Image failed!")},!1),r.addEventListener("load",function(){let t=document.createElement("canvas"),a=t.getContext("2d");t.width=e,t.height=n,a.drawImage(r,o*e,i*n,e,n,0,0,e,n),s.src=t.toDataURL("image/png")},!1),r.src=t,this.frameWidth=e,this.frameHeight=n,this.row=i,this.col=o,this.frameRate=0,this.image=s,this},e.prototype.update=function(t){0!==this.frameRate&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame=(this.currentFrame+1)%this.frames))},n.prototype.update=function(t){this.time+=t},n.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},i.prototype=Object.create(n.prototype),i.prototype.update=function(t){n.prototype.update.call(this,t)},i.prototype.addEnergy=function(){this.energy+=25,this.energy>=100&&(this.energy=100)},i.prototype.loseEnergy=function(){this.energy-=25,this.energy<=0&&s.setGameOver()},i.prototype.move=function(t){this.x=r.INITIAL_WIDTH()/this.rangeOfMovement*t+20},o.prototype=Object.create(n.prototype),o.prototype.update=function(t){n.prototype.update.call(this,t),this.y+=this.speed},a=function(){let t=[];return{update:function(e){let n,i=s.enemies(),o=s.player(),a=o.collisionRect();for(n=i.length-1;n>=0;n--){let e=i[n],s=e.collisionRect();e&&o&&s.intersects(a)?(o.addEnergy(),t.push(e)):e&&s.top()>r.INITIAL_HEIGHT()&&(t.push(e),o.loseEnergy())}},clearEntitiesToRemove:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},entitiesToRemove:function(){return t}}}(),r=function(){let t=(new e).animated("build/sprites/animals.png",26,36,1,1,3,4),n=(new e).animated("build/sprites/animals.png",26,36,3,3,4,6),r=(new e).static("build/sprites/grassland.png",128,128,4,6),a=[].concat(t,n),h=document.getElementById("gameWindow"),c=h.getContext("2d");const u=720,l=480,f=l/u;let d=u,g=l,m=navigator.userAgent.toLowerCase(),p=m.indexOf("android")>-1,y=m.indexOf("iphone")>-1||m.indexOf("ipad")>-1;function I(){d=window.innerHeight,g=d*f,(p||y)&&(document.body.style.height=window.innerHeight+50+"px"),h.style.width=g+"px",h.style.height=d+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function v(t,e,n,i,o){0===t.frameRate?c.drawImage(t.image,e,n,i,o):c.drawImage(t.image,t.frameWidth*t.currentFrame,0,t.frameWidth,t.frameHeight,e,n,i,o)}return h.width=l,h.height=u,I(),window.addEventListener("resize",I,!1),{render:function(e){let h,f,d=s.entities();if(function(){let t,e,n=l/128,i=u/128;for(t=0;t<=n;t++)for(e=0;e<=i;e++)v(r,128*t,128*e,128,128)}(),s.accelerating())for(f=a.length-1;f>=0;f--)a[f].update(e);for(f=0;f<d.length;f++)(h=d[f])instanceof o?(m=h).y<m.invisPointY?v(n,m.x,m.y-m.height/2,1.5*m.width,6*m.height):(c.fillStyle="white",c.fillRect(0,m.y+m.height,l,10)):h instanceof i&&v(t,(g=h).x,g.y-g.height/2,1.5*g.width,1.5*g.height);var g,m},INITIAL_WIDTH:function(){return l},INITIAL_HEIGHT:function(){return u},currentWidth:function(){return g},currentHeight:function(){return d},canvas:function(){return h}}}(),s=function(){let t,e,n,h,c,u,l,f=!0,d=1,g=d,m=!1,p=function(){let t=0,e=2*r.INITIAL_HEIGHT();return function(){let n=r.INITIAL_WIDTH()/h.rangeOfMovement*(i=h.rangeOfMovement,Math.floor(Math.random()*Math.floor(i)))+20;var i;t++,console.log("wave "+t),4==t?console.log("Invisibility gene active on next wave!"):5==t&&(e=r.INITIAL_HEIGHT()/2,console.log("Activating invisibilty gene...")),e>=80&&(e-=10),I(new o(n,-10,g,e))}}();function y(){let t;if(f){for(g=0,console.log("STOP..."),t=0;t<n.length;t++)n[t].speed=g;f=!1}else{for(console.log("hammertime"),g=d,t=0;t<n.length;t++)n[t].speed=g,n[t].y+=g;f=!0}}function I(t){e.push(t),t instanceof i?h=t:t instanceof o&&n.push(t)}return{start:function(){if(console.log("game start"),e=[],n=[],c=!1,u=0,l=[],t=0,"undefined"!=typeof Storage)try{l=JSON.parse(localStorage.sharkAttackScores)}catch(t){l=[]}this.addEntity(new i(0,r.INITIAL_HEIGHT()-60)),p(),m||(requestAnimationFrame(this.update.bind(this)),m=!0)},update:function(i){let s,u,l=[],d=!1,g=h.y-h.height,I=r.INITIAL_HEIGHT()/4,v=Math.min((i-t)/1e3,.05);if(t=i,c)m=!1;else{for(a.update(v),u=0;u<e.length;u++)(s=e[u]).update(v),s instanceof o&&!d&&s.y>=I&&s.y<I+s.speed&&(p(),d=!0),s instanceof o&&f&&s.y>=g&&s.y<g+s.speed&&y(),a.entitiesToRemove().includes(s)&&l.push(s);!function(t){function i(e){return!t.includes(e)}t&&(e=e.filter(i),n=n.filter(i),t.includes(h)&&(h=void 0))}(l),a.clearEntitiesToRemove(),d=!1,r.render(v),requestAnimationFrame(this.update.bind(this))}},addEntity:I,setGameOver:function(){var t;c||(console.log("game over"),c=!0,t=Math.round(s.score()),l.push(t),l.sort(function(t,e){return e-t}),l=l.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(l)))},addScore:function(t){u+=t},toggleAcceleration:y,accelerating:function(){return f},score:function(){return u},highScores:function(){return l},gameOver:function(){return c},entities:function(){return e},enemies:function(){return n},player:function(){return h}}}();let h={49:0,50:1,51:2,52:3};function c(t){let e=r.currentWidth()/r.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==h[e]&&(t.preventDefault(),s.player()&&s.player().move(h[e]),s.accelerating()||s.toggleAcceleration())}),r.canvas().addEventListener("touchstart",function(t){let e,n,i=t.changedTouches;t.preventDefault();for(let t=i.length-1;t>=0;t--)n=(e=c(i[t])).x<.25*r.INITIAL_WIDTH()?0:e.x<.5*r.INITIAL_WIDTH()?1:e.x<.75*r.INITIAL_WIDTH()?2:3,s.player().move(n),s.accelerating()||s.toggleAcceleration()}),s.start()}();