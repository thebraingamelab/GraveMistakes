!function(){"use strict";function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}function e(t,e,n,i){this.x=t,this.y=e,this.time=0,this.width=n,this.height=i}function n(t,n){e.call(this,t,n,40,40),this.rangeOfMovement=4,this.move(0)}function i(t,n,i,o){e.call(this,t,n,40,10),this.invisPointY=o,this.speed=i}let o,r,c;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},e.prototype.update=function(t){this.time+=t},e.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},n.prototype=Object.create(e.prototype),n.prototype.update=function(t){e.prototype.update.call(this,t)},n.prototype.move=function(t){this.x=o.INITIAL_WIDTH()/this.rangeOfMovement*t+20},i.prototype=Object.create(e.prototype),i.prototype.update=function(t){e.prototype.update.call(this,t),this.y+=this.speed},c=function(){let t=[];return{update:function(e){let n,i=r.enemies(),c=r.player(),s=c.collisionRect();for(n=i.length-1;n>=0;n--){let e=i[n],l=e.collisionRect();e&&c&&l.intersects(s)?r.setGameOver():e&&l.top()>o.INITIAL_HEIGHT()&&(t.push(e),r.addScore(1))}},clearOffScreenEntities:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},offScreenEntities:function(){return t}}}(),o=function(){let t=document.getElementById("gameWindow"),e=t.getContext("2d");const o=480,c=o/720;let s=720,l=o,u=navigator.userAgent.toLowerCase(),f=u.indexOf("android")>-1,h=u.indexOf("iphone")>-1||u.indexOf("ipad")>-1;function a(){s=window.innerHeight,l=s*c,(f||h)&&(document.body.style.height=window.innerHeight+50+"px"),t.style.width=l+"px",t.style.height=s+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function d(t,e){t.fillStyle="green",t.fillRect(e.x,e.y,e.width,e.height)}return t.width=o,t.height=720,a(),window.addEventListener("resize",a,!1),{render:function(c){let s,l,u=r.entities();for(e.fillStyle="blue",e.fillRect(0,0,t.width,t.height),l=0;l<u.length;l++)(s=u[l])instanceof i?(f=e,(h=s).y<h.invisPointY?(f.fillStyle="red",f.fillRect(h.x,h.y,h.width,h.height)):(f.setLineDash([5,3]),f.beginPath(),f.moveTo(0,h.invisPointY+h.height),f.lineTo(o,h.invisPointY+h.height),f.stroke(),f.fillStyle="white",f.fillRect(0,h.y+h.height,o,10))):s instanceof n&&d(e,s);var f,h},INITIAL_WIDTH:function(){return o},INITIAL_HEIGHT:function(){return 720},currentWidth:function(){return l},currentHeight:function(){return s},canvas:function(){return t}}}(),r=function(){let t,e,s,l,u,f,h,a,d=!1,p=!1,g=.5,y=g,I=!1;var v=function(){let t=0,e=o.INITIAL_HEIGHT();return function(){let n=(r=4,Math.floor(Math.random()*Math.floor(r)));var r;let c,s;for(t++,console.log("wave "+t),3==t&&(e/=3,console.log("Activating invisibilty gene...")),e>=80&&(e-=10),s=0;s<4;s++)s!==n&&m(new i(c=o.INITIAL_WIDTH()/4*s+20,-10,y,e))}}();function w(){let t;if(p){for(y=g,console.log("Slowing down..."),t=0;t<s.length;t++)s[t].speed=y;p=!1}else{for(console.log("Accelerating..."),y=4*g,t=0;t<s.length;t++)s[t].speed=y;p=!0}}function m(t){e.push(t),t instanceof n?l=t:t instanceof i&&s.push(t)}return{start:function(){if(console.log("game start"),e=[],s=[],f=!1,h=0,a=[],u=1100,t=0,"undefined"!=typeof Storage)try{a=JSON.parse(localStorage.sharkAttackScores)}catch(t){a=[]}this.addEntity(new n(0,o.INITIAL_HEIGHT()-60)),v(),I||(requestAnimationFrame(this.update.bind(this)),I=!0)},update:function(n){let r,u,h=[],a=!1,d=(l.y,o.INITIAL_HEIGHT()/4),g=Math.min((n-t)/1e3,.05);if(t=n,f)I=!1;else{for(c.update(g),u=0;u<e.length;u++)(r=e[u]).update(g),r instanceof i&&r.y>=d&&r.y<d+r.speed&&(a||v(),a=!0),c.offScreenEntities().includes(r)&&h.push(r);0!=c.offScreenEntities().length&&p&&w(),function(t){function n(e){return!t.includes(e)}t&&(e=e.filter(n),s=s.filter(n),t.includes(l)&&(l=void 0))}(h),c.clearOffScreenEntities(),a=!1,o.render(g),requestAnimationFrame(this.update.bind(this))}},addEntity:m,setGameOver:function(){var t;f||(console.log("game over"),f=!0,t=Math.round(r.score()),a.push(t),a.sort(function(t,e){return e-t}),a=a.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(a)))},addScore:function(t){h+=t},endBulletTime:function(){d=!1},toggleAcceleration:w,accelerating:function(){return p},score:function(){return h},highScores:function(){return a},gameOver:function(){return f},entities:function(){return e},enemies:function(){return s},player:function(){return l}}}();let s={49:0,50:1,51:2,52:3};function l(t){let e=o.currentWidth()/o.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0===s[e]||r.accelerating()||(t.preventDefault(),r.player()&&r.player().move(s[e]),r.toggleAcceleration())}),o.canvas().addEventListener("touchstart",function(t){let e,n,i=t.changedTouches;if(t.preventDefault(),!r.accelerating())for(let t=i.length-1;t>=0;t--)n=(e=l(i[t])).x<.25*o.INITIAL_WIDTH()?0:e.x<.5*o.INITIAL_WIDTH()?1:e.x<.75*o.INITIAL_WIDTH()?2:3,r.player().move(n),r.toggleAcceleration()}),r.start()}();