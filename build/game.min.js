!function(){"use strict";function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}function e(t,e,n,i){this.x=t,this.y=e,this.time=0,this.width=n,this.height=i}function n(t,n){e.call(this,t,n,40,40),this.rangeOfMovement=4,this.move(0)}function i(t,n,i,o){e.call(this,t,n,40,10),this.invisPointY=o,this.speed=i}let o,r,s;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},e.prototype.update=function(t){this.time+=t},e.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},n.prototype=Object.create(e.prototype),n.prototype.update=function(t){e.prototype.update.call(this,t)},n.prototype.move=function(t){this.x=o.INITIAL_WIDTH()/this.rangeOfMovement*t+20},i.prototype=Object.create(e.prototype),i.prototype.update=function(t){e.prototype.update.call(this,t),this.y+=this.speed},s=function(){let t=[];return{update:function(e){let n,i=r.enemies(),s=r.player(),c=s.collisionRect();for(n=i.length-1;n>=0;n--){let e=i[n],u=e.collisionRect();e&&s&&u.intersects(c)?r.setGameOver():e&&u.top()>o.INITIAL_HEIGHT()&&(t.push(e),r.addScore(1))}},clearOffScreenEntities:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},offScreenEntities:function(){return t}}}(),o=function(){let t=document.getElementById("gameWindow"),e=t.getContext("2d");const o=320,s=o/480;let c=480,u=o,h=navigator.userAgent.toLowerCase(),f=h.indexOf("android")>-1,l=h.indexOf("iphone")>-1||h.indexOf("ipad")>-1;function a(){c=window.innerHeight,u=c*s,(f||l)&&(document.body.style.height=window.innerHeight+50+"px"),t.style.width=u+"px",t.style.height=c+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function d(t,e){t.fillStyle="green",t.fillRect(e.x,e.y,e.width,e.height)}return t.width=o,t.height=480,a(),window.addEventListener("resize",a,!1),{render:function(s){let c,u,h=r.entities();for(e.fillStyle="blue",e.fillRect(0,0,t.width,t.height),u=0;u<h.length;u++)(c=h[u])instanceof i?(f=e,(l=c).y<l.invisPointY?(f.fillStyle="red",f.fillRect(l.x,l.y,l.width,l.height)):(f.setLineDash([5,3]),f.beginPath(),f.moveTo(0,l.invisPointY+l.height),f.lineTo(o,l.invisPointY+l.height),f.stroke(),f.fillStyle="white",f.fillRect(0,l.y+l.height,o,10))):c instanceof n&&d(e,c);var f,l},INITIAL_WIDTH:function(){return o},INITIAL_HEIGHT:function(){return 480},currentWidth:function(){return u},currentHeight:function(){return c},canvas:function(){return t}}}(),r=function(){let t,e,c,u,h,f,l,a,d,p=!1;var g=function(){let t=0,e=o.INITIAL_HEIGHT();return function(){let n=(r=4,Math.floor(Math.random()*Math.floor(r)));var r;let s,c;for(t++,console.log("wave "+t),3==t&&(e/=4,console.log("Activating invisibilty gene...")),e>=80&&(e-=5),c=0;c<4;c++)c!==n&&y(new i(s=o.INITIAL_WIDTH()/4*c+20,-40,2,e))}}();function y(t){e.push(t),t instanceof n?u=t:t instanceof i&&c.push(t)}return{start:function(){if(console.log("game start"),e=[],c=[],l=!1,a=0,d=[],f=2e3,t=0,"undefined"!=typeof Storage)try{d=JSON.parse(localStorage.sharkAttackScores)}catch(t){d=[]}this.addEntity(new n(0,o.INITIAL_HEIGHT()-60)),h=setInterval(g,2e3),p||(requestAnimationFrame(this.update.bind(this)),p=!0)},update:function(n){let i,r,h=[],f=Math.min((n-t)/1e3,.05);if(t=n,l)p=!1;else{for(s.update(f),r=0;r<e.length;r++)(i=e[r]).update(f),s.offScreenEntities().includes(i)&&h.push(i);!function(t){function n(e){return!t.includes(e)}t&&(e=e.filter(n),c=c.filter(n),t.includes(u)&&(u=void 0))}(h),s.clearOffScreenEntities(),o.render(f),requestAnimationFrame(this.update.bind(this))}},addEntity:y,setGameOver:function(){var t;l||(console.log("game over"),l=!0,clearInterval(h),t=Math.round(r.score()),d.push(t),d.sort(function(t,e){return e-t}),d=d.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(d)))},addScore:function(t){a+=t},score:function(){return a},highScores:function(){return d},gameOver:function(){return l},entities:function(){return e},enemies:function(){return c},player:function(){return u}}}();let c={49:0,50:1,51:2,52:3};function u(t){let e=o.currentWidth()/o.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==c[e]&&(t.preventDefault(),r.player()&&r.player().move(c[e]))}),o.canvas().addEventListener("touchstart",function(t){let e,n,i=t.changedTouches;t.preventDefault();for(let t=i.length-1;t>=0;t--)n=(e=u(i[t])).x<.25*o.INITIAL_WIDTH()?0:e.x<.5*o.INITIAL_WIDTH()?1:e.x<.75*o.INITIAL_WIDTH()?2:3,r.player().move(n)}),r.start()}();