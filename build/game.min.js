!function(){"use strict";function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}function e(t,e){this.x=t,this.y=e,this.time=0,this.width=40,this.height=40}function n(t,n){e.call(this,t,n),this.rangeOfMovement=4,this.move(0)}function i(t,n,i){e.call(this,t,n),this.speed=i}let o,r,s;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},e.prototype.update=function(t){this.time+=t},e.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},n.prototype=Object.create(e.prototype),n.prototype.update=function(t){e.prototype.update.call(this,t)},n.prototype.move=function(t){this.x=o.INITIAL_WIDTH()/this.rangeOfMovement*t+20},i.prototype=Object.create(e.prototype),i.prototype.update=function(t){e.prototype.update.call(this,t),this.y+=this.speed},s=function(){let t=[];return{update:function(e){let n,i=r.enemies(),s=r.player(),u=s.collisionRect();for(n=i.length-1;n>=0;n--){let e=i[n],c=e.collisionRect();e&&s&&c.intersects(u)?r.setGameOver():e&&c.top()>o.INITIAL_HEIGHT()&&(t.push(e),r.addScore(1))}},clearOffScreenEntities:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},offScreenEntities:function(){return t}}}(),o=function(){let t=document.getElementById("gameWindow"),e=t.getContext("2d");const o=320/480;let s=480,u=320,c=navigator.userAgent.toLowerCase(),f=c.indexOf("android")>-1,h=c.indexOf("iphone")>-1||c.indexOf("ipad")>-1;function l(){s=window.innerHeight,u=s*o,(f||h)&&(document.body.style.height=window.innerHeight+50+"px"),t.style.width=u+"px",t.style.height=s+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function a(t,e){t.fillStyle="green",t.fillRect(e.x,e.y,e.width,e.height)}return t.width=320,t.height=480,l(),window.addEventListener("resize",l,!1),{render:function(o){let s,u,c=r.entities();for(e.fillStyle="blue",e.fillRect(0,0,t.width,t.height),u=0;u<c.length;u++)(s=c[u])instanceof i?(h=s,(f=e).fillStyle="red",f.fillRect(h.x,h.y,h.width,h.height)):s instanceof n&&a(e,s);var f,h},INITIAL_WIDTH:function(){return 320},INITIAL_HEIGHT:function(){return 480},currentWidth:function(){return u},currentHeight:function(){return s},canvas:function(){return t}}}(),r=function(){let t,e,u,c,f,h,l,a,d,p=!1;var y=function(){let t=0;return function(){let e=(n=4,Math.floor(Math.random()*Math.floor(n)));var n;let r,s;for(t++,s=0;s<4;s++)s!==e&&g(new i(r=o.INITIAL_WIDTH()/4*s+20,-40,2));console.log("wave "+t)}}();function g(t){e.push(t),t instanceof n?c=t:t instanceof i&&u.push(t)}return{start:function(){if(console.log("game start"),e=[],u=[],l=!1,a=0,d=[],h=2e3,t=0,"undefined"!=typeof Storage)try{d=JSON.parse(localStorage.sharkAttackScores)}catch(t){d=[]}this.addEntity(new n(0,o.INITIAL_HEIGHT()-60)),f=setInterval(y,2e3),p||(requestAnimationFrame(this.update.bind(this)),p=!0)},update:function(n){let i,r,f=[],h=Math.min((n-t)/1e3,.05);if(t=n,l)p=!1;else{for(s.update(h),r=0;r<e.length;r++)(i=e[r]).update(h),s.offScreenEntities().includes(i)&&f.push(i);!function(t){function n(e){return!t.includes(e)}t&&(e=e.filter(n),u=u.filter(n),t.includes(c)&&(c=void 0))}(f),s.clearOffScreenEntities(),o.render(h),requestAnimationFrame(this.update.bind(this))}},addEntity:g,setGameOver:function(){var t;l||(console.log("game over"),l=!0,clearInterval(f),t=Math.round(r.score()),d.push(t),d.sort(function(t,e){return e-t}),d=d.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(d)))},addScore:function(t){a+=t},score:function(){return a},highScores:function(){return d},gameOver:function(){return l},entities:function(){return e},enemies:function(){return u},player:function(){return c}}}();let u={49:0,50:1,51:2,52:3};function c(t){let e=o.currentWidth()/o.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(o.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==u[e]&&(t.preventDefault(),r.player()&&r.player().move(u[e]))}),o.canvas().addEventListener("touchstart",function(t){let e,n,i=t.changedTouches;t.preventDefault();for(let t=i.length-1;t>=0;t--)e=c(i[t]),console.log(e.x),n=e.x<.25*o.INITIAL_WIDTH()?0:e.x<.5*o.INITIAL_WIDTH()?1:e.x<.75*o.INITIAL_WIDTH()?2:3,r.player().move(n)}),r.start()}();