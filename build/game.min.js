!function(){"use strict";function t(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t[t.length-1]=void 0,t.length=t.length-1)}function e(t){this.template=t,this.pool=[]}function i(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function n(){}function o(t,e,n,o,r){this.x=t,this.y=e,this.time=0,this.draw=!0,this.width=n,this.height=o,this.sprite=r,this.hitbox=new i(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function r(t,e,i,n,r){o.call(this,t,e,i,n,r)}function s(t,e,i){o.call(this,t,e,40,40,i),this.rangeOfMovement=4,this.maxLife=75,this.life=this.maxLife,this.move(0)}function h(t,e,i,n,r){o.call(this,t,e,40,10,r),this.invisPointY=n,this.speed=i,this.disappeared=!1}let a,c;function l(t){let e=a.currentWidth()/a.INITIAL_WIDTH;return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(a.canvas))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(a.canvas))/e}}e.prototype.take=function(){let t,e;for(e=0;e<this.pool.length;e++)if(this.pool[e].available)return this.pool[e].available=!1,this.pool[e].object.init(),this.pool[e].object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},e.prototype.putBack=function(t){let e;for(e=0;e<this.pool.length;e++)if(this.pool[e].object===t){this.pool[e].available=!0;break}},i.prototype.left=function(){return this.x},i.prototype.right=function(){return this.x+this.width},i.prototype.top=function(){return this.y},i.prototype.bottom=function(){return this.y+this.height},i.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},i.prototype.union=function(t){let e,i,n,o;void 0!==t&&(e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=o)},n.prototype.animated=function(t,e,i,n,o,r,s,h,a,c){let l=document.createElement("img"),u=document.createElement("img");return l.addEventListener("load",function t(){let s=document.createElement("canvas"),h=s.getContext("2d");s.width=e*r,s.height=i,h.drawImage(l,c*n,a*o,n*r,o,0,0,e*r,i),u.src=s.toDataURL("image/png"),l.removeEventListener("load",t)},!1),l.src=t,this.width=e,this.height=i,this.row=a,this.col=c,this.frames=r,this.frameRate=s,this.timer=0,this.currentFrame=0,this.loopOnce=h,this.image=u,this},n.prototype.static=function(t,e,i,n,o,r,s){let h=document.createElement("img"),a=document.createElement("img");return h.addEventListener("load",function t(){let c=document.createElement("canvas"),l=c.getContext("2d");c.width=e,c.height=i,l.drawImage(h,s*n,r*o,n,o,0,0,e,i),a.src=c.toDataURL("image/png"),h.removeEventListener("load",t)},!1),h.src=t,this.width=e,this.height=i,this.row=r,this.col=s,this.frameRate=0,this.frames=0,this.currentFrame=0,this.image=a,this},n.prototype.tiled=function(t,e,i,n,o,r,s,h,a){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function t(){let u,p,d=document.createElement("canvas"),f=d.getContext("2d");for(d.width=e,d.height=i,u=0;u<h;u++)for(p=0;p<a;p++)f.drawImage(c,s*n,r*o,n,o,u*e/h,p*i/a,e/h,i/a);l.src=d.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.row=r,this.col=s,this.frameRate=0,this.frames=0,this.currentFrame=0,this.image=l,this},n.prototype.resetAnimation=function(){this.currentFrame=0},n.prototype.update=function(t){0!==this.frameRate&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.loopOnce?this.currentFrame<this.frames-1&&this.currentFrame++:this.currentFrame=(this.currentFrame+1)%this.frames))},o.prototype.init=function(){this.x=0,this.y=0,this.time=0,this.draw=!0,this.sprite=null},o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.sprite)},o.prototype.update=function(t){this.time+=t},o.prototype.collisionRect=function(){return this.hitbox.x=this.x-this.width/2,this.hitbox.y=this.y-this.height/2,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},o.prototype.collisionLine=function(){return this.hitbox.x=this.x-this.width/2,this.hitbox.y=this.y-this.height/2,this.hitbox.width=this.width,this.hitbox.height=1,this.hitbox},r.prototype=Object.create(o.prototype),r.prototype.init=function(){o.prototype.init.call(this)},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height,this.sprite)},s.prototype=Object.create(o.prototype),s.prototype.update=function(t){o.prototype.update.call(this,t),c.addScore(1)},s.prototype.addLife=function(){this.life+=25,this.life>=this.maxLife&&(this.life=this.maxLife)},s.prototype.loseLife=function(){this.life-=25,this.life<=0&&c.setGameOver()},s.prototype.move=function(t){this.x=a.INITIAL_WIDTH/this.rangeOfMovement*t+20},h.prototype=Object.create(o.prototype),h.prototype.init=function(){o.prototype.init.call(this),this.invisPointY=0,this.speed=0,this.disappeared=!1},h.prototype.clone=function(){return new h(this.x,this.y,this.speed,this.invisPointY,this.sprite)},h.prototype.update=function(t){o.prototype.update.call(this,t),this.y+=this.speed},a=function(){let t=document.querySelector("#gameWindow"),e=t.getContext("2d");const i=720,o=480;let s=i,a=o;function l(){const e=o/i,n=navigator.userAgent.toLowerCase(),r=n.indexOf("android")>-1,h=n.indexOf("iphone")>-1||n.indexOf("ipad")>-1;let c=document.querySelector(".container");s=window.innerHeight,a=s*e,(r||h)&&(document.body.style.height=window.innerHeight+50+"px"),t.style.width=a+"px",t.style.height=s+"px",c.style.width=a+"px",c.style.height=s+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function u(t,i,n){0===t.frameRate||t.loopOnce&&t.currentFrame>=t.frames?e.drawImage(t.image,t.width*t.frames,0,t.width,t.height,i,n,t.width,t.height):e.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,i,n,t.width,t.height)}t.width=o,t.height=i,l(),window.addEventListener("resize",function(t,e,i){let n;return function(){let o=this,r=arguments,s=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(o,r)},e),s&&t.apply(o,r)}}(l,250,!1),!1);let p=function(){let t=0,e=(new n).tiled("build/sprites/grassland.png",o,i,128,128,4,6,4,10);return function(){u(e,0,t-i),u(e,0,t),c.accelerating()&&!c.gameOver()&&(t+=6),t>=i&&(t=0)}}();return{render:function(t){let e,i,n=c.entities();for(p(),i=0;i<n.length;i++)e=n[i],(c.accelerating()||e instanceof r)&&e.sprite.update(t),e.draw&&e instanceof h&&e.disappeared?u(e.sprite,0,e.y-e.height/2):e.draw&&u(e.sprite,e.x,e.y-e.height/2)},INITIAL_WIDTH:o,INITIAL_HEIGHT:i,canvas:t,currentWidth:function(){return a}}}(),c=function(){let i,o,c,l,u,p,d,f,m,g,y,I,w,v=(new n).animated("build/sprites/animals.png",60,60,26,37,2,6,!1,3,3),x=(new n).static("build/sprites/animals.png",60,60,26,36,4,7),L=(new n).animated("build/sprites/explosion.png",60,60,223,174,21,21,!0,0,0),T=(new n).tiled("build/sprites/grassland.png",a.INITIAL_WIDTH,60,128,128,15,4,6,1),b=(new n).animated("build/sprites/tap.png",75,76,75,76,2,3,!1,0,0),E=new e(new r(0,0,0,0,null)),H=new e(new h(0,0,0,0,null)),A=6,O=!1,N=2,_=0,R=0,F=!1,M=2*a.INITIAL_HEIGHT,D=document.querySelector("#start_button");function S(){let t,e;var i;return 5===R&&(M=a.INITIAL_HEIGHT/2),M>=80&&(M-=10),e=a.INITIAL_WIDTH/l.rangeOfMovement*(i=l.rangeOfMovement,Math.floor(Math.random()*Math.floor(i)))+20,(t=H.take()).x=e,t.y=-10,t.speed=A,t.invisPointY=M,t.sprite=x,t.disappeared=!1,B(t),R++,e}function W(){p=!p}function k(){O=!O}function B(t){i.push(t),t instanceof s?l=t:t instanceof h&&c.push(t)}function G(e){let n;if(0!==e.length){for(n=0;n<e.length;n++){let o,s=e[n];(o=i.indexOf(s))>=0&&t(i,o),(o=c.indexOf(s))>=0&&(t(c,o),H.putBack(s)),s instanceof r&&E.putBack(s)}e.includes(l)&&(l=void 0)}}function P(t,e){let i=t.collisionLine(),n=e.collisionLine();return i.intersects(n)}return{start:function(){if(i&&G(i),i=[],c=[],o=[],f=[],_=0,R=0,m=!1,O=!1,p=!0,d=!1,I=0,u=0,M=2*a.INITIAL_HEIGHT,L.resetAnimation(),D.style.display="none","undefined"!=typeof Storage)try{w=JSON.parse(localStorage.nBackScores)}catch(t){w=[]}B(new s(0,a.INITIAL_HEIGHT-60,v));let t=E.take();t.x=S(),t.y=.75*a.INITIAL_HEIGHT,t.width=b.width,t.height=b.height,t.sprite=b,B(t),F||(F=!0,g=this.update.bind(this),y&&cancelAnimationFrame(y),window.requestAnimationFrame(g))},update:function(t){let e,n,s,c=l.y-l.height,I=a.INITIAL_HEIGHT/4,w=Math.min((t-u)/1e3,.05);if(u=t,m)return F=!1,a.render(w),void(y=window.requestAnimationFrame(g));for(s=0;s<i.length;s++){if(n=(e=i[s]).invisPointY-I,O&&e.update(w),e.y>a.INITIAL_HEIGHT?(o.push(e),e instanceof h&&(l.loseLife(),p&&W())):e instanceof h&&P(e,l)?(l.addLife(),o.push(e),p&&W()):e instanceof h&&e.y>=n&&e.y<e.invisPointY?e.draw=!e.draw:e instanceof h&&e.y>=e.invisPointY&&e.y<e.invisPointY+e.speed&&(e.sprite=T,e.draw=!0,e.disappeared=!0),e instanceof h&&e.y>=I&&e.y<I+e.speed){let t=S();f.length<N&&f.push(t)}if(e instanceof h&&O&&!p&&e.y>=c&&e.y<c+e.speed&&(k(),W(),_<N)){let t=E.take();t.x=f[_],t.y=.75*a.INITIAL_HEIGHT,t.width=b.width,t.height=b.height,t.sprite=b,B(t),_++}d&&e instanceof r&&o.push(e)}d&&(d=!1),G(o),o.length=0,a.render(w),window.requestAnimationFrame(g)},setGameOver:function(){var t;m||(m=!0,l.sprite=L,D.style.display="block",t=Math.round(I),w.push(t),w.sort(function(t,e){return e-t}),w=w.slice(0,10),"undefined"!=typeof Storage&&(localStorage.nBackScores=JSON.stringify(w)),console.log(w))},addScore:function(t){I+=t},toggleAcceleration:k,toggleInputBuffer:W,setInputEventFired:function(){d=!0},accelerating:function(){return O},inputBuffered:function(){return p},gameOver:function(){return m},entities:function(){return i},enemies:function(){return c},player:function(){return l}}}(),a.canvas.addEventListener("click",function(t){let e,i,n=l(t),o=c.player();t.preventDefault(),!c.gameOver()&&o&&(i=o.rangeOfMovement,e=n.x<a.INITIAL_WIDTH*(1/i)?0:n.x<a.INITIAL_WIDTH*(2/i)?1:n.x<a.INITIAL_WIDTH*(3/i)?2:3,o.move(e),c.setInputEventFired(),c.accelerating()?c.inputBuffered()||c.toggleInputBuffer():c.toggleAcceleration())}),a.canvas.addEventListener("touchstart",function(t){let e,i,n,o=t.changedTouches,r=c.player();if(t.preventDefault(),!c.gameOver()&&r){n=r.rangeOfMovement;for(let t=o.length-1;t>=0;t--)i=(e=l(o[t])).x<a.INITIAL_WIDTH*(1/n)?0:e.x<a.INITIAL_WIDTH*(2/n)?1:e.x<a.INITIAL_WIDTH*(3/n)?2:3,r.move(i),c.setInputEventFired(),c.accelerating()?c.inputBuffered()||c.toggleInputBuffer():c.toggleAcceleration()}}),document.querySelector("#start_button").addEventListener("click",function(){c.start()})}();