!function(){"use strict";function t(t){this.template=t,this.pool=[]}function e(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t[t.length-1]=void 0,t.length=t.length-1)}function i(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function n(){}function o(t,e,n,o,s){this.x=t,this.y=e,this.time=0,this.draw=!0,this.width=n,this.height=o,this.sprite=s,this.hitbox=new i(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function s(t,e,i){o.call(this,t,e,40,40,i),this.rangeOfMovement=4,this.maxLife=75,this.life=this.maxLife,this.move(0)}function h(t,e,i,n,s){o.call(this,t,e,40,10,s),this.invisPointY=n,this.speed=i,this.disappeared=!1}let r,a;t.prototype.take=function(){let t,e;for(e=0;e<this.pool.length;e++)if(this.pool[e].available)return this.pool[e].available=!1,this.pool[e].object.init(),this.pool[e].object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},t.prototype.putBack=function(t){let e;for(e=0;e<this.pool.length;e++)if(this.pool[e].object===t){this.pool[e].available=!0;break}},i.prototype.left=function(){return this.x},i.prototype.right=function(){return this.x+this.width},i.prototype.top=function(){return this.y},i.prototype.bottom=function(){return this.y+this.height},i.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},i.prototype.union=function(t){let e,i,n,o;void 0!==t&&(e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=o)},n.prototype.animated=function(t,e,i,n,o,s,h,r,a,c){let l=document.createElement("img"),u=document.createElement("img");return l.addEventListener("load",function(){let t=document.createElement("canvas"),h=t.getContext("2d");t.width=e*s,t.height=i,h.drawImage(l,c*n,a*o,n*s,o,0,0,e*s,i),u.src=t.toDataURL("image/png")},!1),l.src=t,this.width=e,this.height=i,this.row=a,this.col=c,this.frames=s,this.frameRate=h,this.timer=0,this.currentFrame=0,this.loopOnce=r,this.image=u,this},n.prototype.static=function(t,e,i,n,o,s,h){let r=document.createElement("img"),a=document.createElement("img");return r.addEventListener("load",function(){let t=document.createElement("canvas"),c=t.getContext("2d");t.width=e,t.height=i,c.drawImage(r,h*n,s*o,n,o,0,0,e,i),a.src=t.toDataURL("image/png")},!1),r.src=t,this.width=e,this.height=i,this.row=s,this.col=h,this.frameRate=0,this.frames=0,this.currentFrame=0,this.image=a,this},n.prototype.tiled=function(t,e,i,n,o,s,h,r,a){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function(){let t,u,p=document.createElement("canvas"),f=p.getContext("2d");for(p.width=e,p.height=i,t=0;t<r;t++)for(u=0;u<a;u++)f.drawImage(c,h*n,s*o,n,o,t*e/r,u*i/a,e/r,i/a);l.src=p.toDataURL("image/png")},!1),c.src=t,this.width=e,this.height=i,this.row=s,this.col=h,this.frameRate=0,this.frames=0,this.currentFrame=0,this.image=l,this},n.prototype.update=function(t){0!==this.frameRate&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.loopOnce?this.currentFrame<this.frames-1&&this.currentFrame++:this.currentFrame=(this.currentFrame+1)%this.frames))},o.prototype.init=function(){this.x=0,this.y=0,this.time=0,this.draw=!0,this.sprite=null},o.prototype.clone=function(){return new o(this.x,this.y,this.width,this,height,this.sprite)},o.prototype.update=function(t){this.time+=t},o.prototype.collisionRect=function(){return this.hitbox.x=this.x-this.width/2,this.hitbox.y=this.y-this.height/2,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},o.prototype.collisionLine=function(){return this.hitbox.x=this.x-this.width/2,this.hitbox.y=this.y-this.height/2,this.hitbox.width=this.width,this.hitbox.height=1,this.hitbox},s.prototype=Object.create(o.prototype),s.prototype.update=function(t){o.prototype.update.call(this,t),a.addScore(1)},s.prototype.addLife=function(){this.life+=25,this.life>=this.maxLife&&(this.life=this.maxLife)},s.prototype.loseLife=function(){this.life-=25,this.life<=0&&a.setGameOver()},s.prototype.move=function(t){this.x=r.INITIAL_WIDTH/this.rangeOfMovement*t+20},h.prototype.init=function(){o.prototype.init.call(this),this.invisPointY=0,this.speed=0,this.disappeared=!1},o.prototype.clone=function(){return new h(this.x,this.y,this.speed,this.invisPointY,this.sprite)},h.prototype=Object.create(o.prototype),h.prototype.update=function(t){o.prototype.update.call(this,t),this.y+=this.speed},r=function(){let t=document.getElementById("gameWindow"),e=t.getContext("2d");const i=720,o=480;let r=i,c=o;function l(t,i,n){0===t.frameRate||t.loopOnce&&t.currentFrame>=t.frames?e.drawImage(t.image,t.width*t.frames,0,t.width,t.height,i,n,t.width,t.height):e.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,i,n,t.width,t.height)}t.width=o,t.height=i,function(){const e=o/i,n=navigator.userAgent.toLowerCase(),s=n.indexOf("android")>-1,h=n.indexOf("iphone")>-1||n.indexOf("ipad")>-1;let a=document.getElementsByClassName("container")[0];r=window.innerHeight,c=r*e,(s||h)&&(document.body.style.height=window.innerHeight+50+"px");t.style.width=c+"px",t.style.height=r+"px",a.style.width=c+"px",a.style.height=r+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}();let u=function(){let t=0,e=(new n).tiled("build/sprites/grassland.png",o,i,128,128,4,6,6,10);return function(){l(e,0,t-i),l(e,0,t),a.accelerating()&&!a.gameOver()&&(t+=6),t>=i&&(t=0)}}();return{render:function(t){let e,i,n=a.entities();for(u(),i=0;i<n.length;i++)e=n[i],a.accelerating()&&e.sprite.update(t),e.draw&&e instanceof h?e.disappeared?l(e.sprite,0,e.y-e.height/2):l(e.sprite,e.x,e.y-e.height/2):e.draw&&e instanceof s&&l(e.sprite,e.x,e.y-e.height/2)},INITIAL_WIDTH:o,INITIAL_HEIGHT:i,currentWidth:c,canvas:t}}(),a=function(){let i,o,a,c,l,u,p,f,d,m=(new n).animated("build/sprites/animals.png",60,60,26,37,2,6,!1,3,3),g=(new n).static("build/sprites/animals.png",60,60,26,36,4,7),y=(new n).animated("build/sprites/explosion.png",60,60,223,174,21,21,!0,0,0),w=(new n).tiled("build/sprites/grassland.png",r.INITIAL_WIDTH,60,128,128,15,4,6,1),I=new t(new h(0,0,0,0,null)),x=!1,v=!0,b=!1,L=function(){let t=0,e=2*r.INITIAL_HEIGHT;return function(){let i=r.INITIAL_WIDTH/c.rangeOfMovement*(n=c.rangeOfMovement,Math.floor(Math.random()*Math.floor(n)))+20;var n;let o=I.take();o.x=i,o.y=-10,o.speed=6,o.invisPointY=e,o.sprite=g,o.disappeared=!1,O(o),4==++t||5==t&&(e=r.INITIAL_HEIGHT/2),e>=80&&(e-=10)}}();function T(){v=!v}function E(){x=!x}function O(t){i.push(t),t instanceof s?c=t:t instanceof h&&a.push(t)}function A(t,e){let i=t.collisionLine(),n=e.collisionLine();return i.intersects(n)}return{start:function(){if(i=[],a=[],o=[],u=!1,f=0,d=[],l=0,"undefined"!=typeof Storage)try{d=JSON.parse(localStorage.sharkAttackScores)}catch(t){d=[]}O(new s(0,r.INITIAL_HEIGHT-60,m)),L(),b||(b=!0,p=this.update.bind(this),requestAnimationFrame(p))},update:function(t){let n,s,f,d=c.y-c.height,m=r.INITIAL_HEIGHT/4,g=Math.min((t-l)/1e3,.05);if(l=t,u)return b=!1,r.render(g),void requestAnimationFrame(p);for(f=0;f<i.length;f++)s=(n=i[f]).invisPointY-m,x&&n.update(g),n.y>r.INITIAL_HEIGHT?(o.push(n),n instanceof h&&(c.loseLife(),v&&T())):n instanceof h&&A(n,c)?(c.addLife(),o.push(n),v&&T()):n instanceof h&&n.y>=s&&n.y<n.invisPointY?n.draw=!n.draw:n instanceof h&&n.y>=n.invisPointY&&n.y<n.invisPointY+n.speed&&(n.sprite=w,n.draw=!0,n.disappeared=!0),n instanceof h&&n.y>=m&&n.y<m+n.speed&&L(),n instanceof h&&x&&!v&&n.y>=d&&n.y<d+n.speed&&(E(),T());!function(t){let n;if(0!==t.length){for(n=0;n<t.length;n++){let o,s=t[n];(o=i.indexOf(s))>=0&&e(i,o),(o=a.indexOf(s))>=0&&(e(a,o),I.putBack(s))}t.includes(c)&&(c=void 0)}}(o),o.length=0,r.render(g),requestAnimationFrame(p)},setGameOver:function(){var t;u||(u=!0,c.sprite=y,t=Math.round(f),d.push(t),d.sort(function(t,e){return e-t}),d=d.slice(0,10),"undefined"!=typeof Storage&&(localStorage.nBackScores=JSON.stringify(d)))},addScore:function(t){f+=t,console.log(f)},toggleAcceleration:E,toggleInputBuffer:T,accelerating:function(){return x},inputBuffered:function(){return v},gameOver:function(){return u},entities:function(){return i},enemies:function(){return a},player:function(){return c}}}();let c={49:0,50:1,51:2,52:3};function l(t){let e=r.currentWidth/r.INITIAL_WIDTH;return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(r.canvas))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(r.canvas))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==c[e]&&a.player()&&!a.gameOver()&&(t.preventDefault(),a.player().move(c[e]),a.accelerating()?a.inputBuffered()||a.toggleInputBuffer():a.toggleAcceleration())}),r.canvas.addEventListener("touchstart",function(t){let e,i,n=t.changedTouches;if(t.preventDefault(),!a.gameOver())for(let t=n.length-1;t>=0;t--)i=(e=l(n[t])).x<.25*r.INITIAL_WIDTH?0:e.x<.5*r.INITIAL_WIDTH?1:e.x<.75*r.INITIAL_WIDTH?2:3,a.player().move(i),a.accelerating()?a.inputBuffered()||a.toggleInputBuffer():a.toggleAcceleration()}),a.start()}();