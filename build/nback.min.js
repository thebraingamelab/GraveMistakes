!function(){"use strict";let t={canvasId:"game-canvas",wrapperId:"canvas-wrapper",containerId:"game-container",resizeDelay:250,canvasPosition:"bottom center",stretchToFit:!1,orientation:"portrait",gameFieldWidth:540,gameFieldHeight:960},e=function(){if(!t)return console.log("ERROR: unable to load config.js"),null;let e,i,n,o,r,s,a,h,l,c,d,u,p,f,g,m=!1,y=[],w=0;function v(){window.devicePixelRatio;let i,m;for(r=parseFloat(window.getComputedStyle(l).getPropertyValue("padding-left")),s=parseFloat(window.getComputedStyle(l).getPropertyValue("padding-right")),a=parseFloat(window.getComputedStyle(l).getPropertyValue("padding-top")),h=parseFloat(window.getComputedStyle(l).getPropertyValue("padding-bottom")),n=l.clientHeight-(a+h),o=l.clientWidth-(r+s),g="both"===t.orientation?window.innerWidth>=window.innerHeight?"landscape":"portrait":t.orientation,t.stretchToFit?(u=n,p=o):"portrait"===g?(f="fitWidth",i=t.gameFieldWidth/t.gameFieldHeight,p=(u=n)*i,Math.floor(p)>o&&(f="fitHeight",i=t.gameFieldHeight/t.gameFieldWidth,u=(p=o)*i)):(f="fitHeight",i=t.gameFieldHeight/t.gameFieldWidth,u=(p=o)*i,Math.floor(u)>n&&(f="fitWidth",i=t.gameFieldWidth/t.gameFieldHeight,p=(u=n)*i)),d.style.width=Math.round(p)+"px",d.style.height=Math.round(u)+"px",function(){let e,i,c,f,g=t.canvasPosition.split(" ");"absolute"===window.getComputedStyle(l).getPropertyValue("position")?(e=document.body.getBoundingClientRect(),i=l.getBoundingClientRect(),c=i.left-e.left,f=i.top-e.top):(c=0,f=0);switch(g[0]){default:case"center":d.style.top=Math.round(f+a+(n/2-u/2))+"px";break;case"top":d.style.top=Math.round(f+a)+"px";break;case"bottom":d.style.top=Math.round(f+l.clientHeight-u-h)+"px"}switch(g[1]){default:case"center":d.style.left=Math.round(c+r+(o/2-p/2))+"px";break;case"left":d.style.left=Math.round(c+r)+"px";break;case"right":d.style.left=Math.round(c+l.clientWidth-p-s)+"px"}}(),e=c.getBoundingClientRect(),m=0;m<w;m++)y[m]()}return{init:function(){m?console.log("ERROR: resizer already initialized."):(m=!0,l=document.getElementById(t.containerId),""!==t.canvasId&&(c=document.getElementById(t.canvasId),i=c.getContext("2d"),d=""!==t.wrapperId?document.getElementById(t.wrapperId):c,p=t.gameFieldWidth,u=t.gameFieldHeight,c.width=p,c.height=u,c.style.width="100%",c.style.height="100%",d.style.position="absolute"),t.resizeDelay>0?window.addEventListener("resize",function(t,e,i){let n;return function(){let o=this,r=arguments,s=i&&!n;clearTimeout(n),n=window.setTimeout(function(){n=null,i||t.apply(o,r)},e),s&&t.apply(o,r)}}(v,t.resizeDelay,!1),!1):window.addEventListener("resize",v,!1),v())},resize:v,getOrientation:function(){return g},getSizeMode:function(){return f},getCanvas:function(){return c||(console.log("ERROR: canvas has been set to false in config.js"),null)},getContainer:function(){return l},getGameHeight:function(){return t.gameFieldHeight},getGameWidth:function(){return t.gameFieldWidth},getCanvasWidth:function(){return p},getCanvasHeight:function(){return u},getCanvasBoundingRect:function(){return e},addResizeEvent:function(t){y.push(t),w++},removeResizeEvent:function(t){let e=0;for(;y[e]!==t&&e<w;)e++;e<w&&(y[e]=y[y.length-1],y[y.length-1]=void 0,y.length=y.length-1)},getRelativeEventCoords:function(e){let i=p/t.gameFieldWidth;return{x:(e.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(d))/i,y:(e.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(d))/i}}}}();e.init();const i=e.getGameHeight(),n=e.getGameWidth();let o,r=32,s=new T(-1*r,-1*r,r,r+10),a=null,h=null,l=document.getElementById("top-bar"),c=document.getElementById("pause-box"),d=document.getElementById("help-box"),u=document.getElementById("pause"),p=document.getElementById("help"),f=document.getElementById("pause-menu"),g=document.getElementById("resume"),m=document.getElementById("restart"),y=document.getElementById("exit"),w=document.getElementById("music-mini"),v=document.getElementById("volume-mini"),b=document.getElementById("help-mini"),E=document.getElementById("help-menu"),k=document.getElementById("help-back"),x=document.getElementById("report-a-bug"),L=document.getElementById("tutorial"),I=document.getElementById("not-implemented-menu"),F=document.getElementById("not-implemented-back"),R=document.getElementById("dimmer");function B(){M(E,I)}function A(){M(f,I)}function C(t){t.classList.remove("center-popin"),t.classList.add("center-popout"),R.classList.remove("partial-fade-out"),R.classList.add("partial-fade-in"),l.style.display="none"}function M(t,e){t.classList.remove("center-popout"),t.classList.add("center-popin"),t.addEventListener("animationend",function i(){e.classList.remove("center-popin"),e.classList.add("center-popout"),t.removeEventListener("animationend",i)},!1)}function P(t){return Math.floor(Math.random()*Math.floor(t))}function S(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t[t.length-1]=void 0,t.length=t.length-1)}function _(t){this.template=t,this.pool=[]}function T(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function W(t,e,i,n,o){this.width=e,this.height=i,this.frames=n,this.frameRate=o,this.timer=0,this.currentFrame=0,this.image=t,this.animationEndEvent=null,this.layers=[],this.draw=!0,this.foreground=!1,this.alpha=1,this.fadeAmt=0}function O(t,e,i,n,o){this.x=t,this.y=e,this.xFraction=0,this.yFraction=0,this.time=0,this.width=i,this.height=n,this.sprite=o,this.hitbox=new T(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function D(t,e,i,n,o){O.call(this,t,e,i,n,o)}function N(t,e,i){let n=0,o=0;i&&(n=i.width,o=i.height),O.call(this,t,e,n,o,i),this.maxLife=3,this.life=this.maxLife}function H(t,e,i,n,o){let r=0,s=0;o&&(r=o.width,s=o.height),O.call(this,t,e,r,s,o),this.invisPointY=n,this.speed=i,this.isFake=!1,this.lane=1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1}function z(t,e,i,n=!1){let o,r,s=this;if(this.buffer=null,this.audioContext=e,this.gainNode=i,this.loop=n,(o=document.createElement("audio")).canPlayType)if(o.canPlayType&&""!==o.canPlayType("audio/mp4"))t+=".mp4";else{if(!o.canPlayType||""===o.canPlayType('audio/ogg; codecs="vorbis"'))return void console.log("Error: MP4 and OGG files are unsupported on this device.");t+=".ogg"}(r=new XMLHttpRequest).open("GET",encodeURI(t),!0),r.responseType="arraybuffer",r.addEventListener("error",function(){console.log("Error loading from server: "+t)},!1),r.addEventListener("load",function(){e.decodeAudioData(r.response,function(t){s.buffer=t},function(t){console.log("Error decoding audio data: "+t.err)})},!1),r.send()}_.prototype.take=function(){let t,e,i=this.pool.length,n=null;for(e=0;e<i;e++)if((n=this.pool[e]).available)return n.available=!1,n.object.init(),n.object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},_.prototype.putBack=function(t){let e,i,n=this.pool.length;for(i=0;i<n;i++)if((e=this.pool[i]).object===t)return void(e.available=!0)},T.prototype.left=function(){return this.x},T.prototype.right=function(){return this.x+this.width},T.prototype.top=function(){return this.y},T.prototype.bottom=function(){return this.y+this.height},T.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},T.prototype.contains=function(t,e){return this.left()<=t&&t<=this.right()&&this.bottom()<=e&&e<=this.top()},T.prototype.union=function(t){let e,i,n,o;if(void 0!==t)return e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=o,this},T.prototype.intersection=function(t){let e,i,n,o;return e=Math.max(this.left(),t.left()),o=Math.min(this.bottom(),t.bottom()),i=Math.min(this.right(),t.right()),n=Math.max(this.top(),t.top()),e>i||o<n?(this.x=-1,this.y=-1,this.width=0,this.height=0):(this.x=e,this.y=n,this.width=i-e,this.height=o-n),this},T.prototype.getArea=function(){return this.height*this.width},W.prototype.eventDriven=function(t,e,i,n,o,r,s,a,h){let l=document.createElement("img"),c=document.createElement("img");return l.addEventListener("load",function t(){let s=document.createElement("canvas"),d=s.getContext("2d");s.width=e*r,s.height=i,d.drawImage(l,h*n,a*o,n*r,o,0,0,e*r,i),c.src=s.toDataURL("image/png"),l.removeEventListener("load",t)},!1),l.src=t,this.width=e,this.height=i,this.frames=r,this.frameRate=s,this.image=c,this},W.prototype.tiled=function(t,e,i,n,o,r,s,a,h){let l=document.createElement("img"),c=document.createElement("img");return l.addEventListener("load",function t(){let d,u,p=document.createElement("canvas"),f=p.getContext("2d");for(p.width=e,p.height=i,d=0;d<a;d++)for(u=0;u<h;u++)f.drawImage(l,s*n,r*o,n,o,d*e/a,u*i/h,e/a,i/h);c.src=p.toDataURL("image/png"),l.removeEventListener("load",t)},!1),l.src=t,this.width=e,this.height=i,this.frameRate=0,this.frames=1,this.image=c,this},W.prototype.resetAnimation=function(){this.currentFrame=0},W.prototype.update=function(t){let e;var i,n,o;for(this.alpha=(i=this.alpha+this.fadeAmt,n=0,o=1,Math.min(Math.max(i,n),o)),e=0;e<this.layers.length;e++)this.layers[e].update(t);this.frameRate>0&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame++,this.currentFrame>this.frames-1&&null!==this.animationEndEvent&&this.animationEndEvent()))},W.prototype.init=function(){this.width=0,this.height=0,this.frameRate=0,this.frames=0,this.currentFrame=0,this.timer=0,this.alpha=1,this.fadeAmt=0,this.layers.length=0,this.image=null,this.animationEndEvent=null,this.draw=!0,this.foreground=!1},W.prototype.clone=function(){return new W(this.image,this.width,this.height,this.frames,this.frameRate)},W.prototype.copyAttributes=function(t){return this.width=t.width,this.height=t.height,this.frameRate=t.frameRate,this.frames=t.frames,this.image=t.image,this.animationEndEvent=t.animationEndEvent,this.draw=t.draw,this.alpha=t.alpha,this.fadeAmt=t.fadeAmt,this.foreground=t.foreground,this},W.prototype.addLayer=function(t){this.layers.push(t)},O.prototype.init=function(){this.x=0,this.y=0,this.xFraction=0,this.yFraction=0,this.time=0,this.sprite=null},O.prototype.clone=function(){return new O(this.x,this.y,this.width,this.height,this.sprite)},O.prototype.update=function(t){let e=this.x,i=this.y,n=this.xFraction,o=this.yFraction;this.time+=t,e+=n,i+=o,e-=n=e%1,i-=o=i%1,this.x=e,this.y=i,this.xFraction=n,this.yFraction=o},O.prototype.collisionRect=function(){return this.hitbox.x=this.x,this.hitbox.y=this.y,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},O.prototype.isCollidingWith=function(t){let e=this.collisionRect(),i=t.collisionRect();return e.intersects(i)},D.prototype=Object.create(O.prototype),D.prototype.init=function(){O.prototype.init.call(this)},D.prototype.clone=function(){return new D(this.x,this.y,this.width,this.height,this.sprite)},N.prototype=Object.create(O.prototype),N.prototype.update=function(t){O.prototype.update.call(this,t),V.addScore(1)},N.prototype.addLife=function(){this.life+=1,this.life>=this.maxLife&&(this.life=this.maxLife)},N.prototype.loseLife=function(){this.life-=1,this.life<=0&&V.setGameOver()},N.prototype.move=function(t,e){this.x=t,this.y=e},H.prototype=Object.create(O.prototype),H.prototype.init=function(){O.prototype.init.call(this),this.x=-100,this.y=-100,this.invisPointY=0,this.speed=0,this.lane=1,this.isFake=!1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1},H.prototype.clone=function(){return new H(this.x,this.y,this.speed,this.invisPointY,this.sprite)},H.prototype.update=function(t){O.prototype.update.call(this,t),this.y+=this.speed},z.prototype.play=function(){let t=this;if(this.buffer){let t=this.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gainNode).connect(this.audioContext.destination),t.start(0),t.loop=this.loop}else window.setTimeout(function(){t.play()},50)};let G=function(){let t=new _(new W(null,0,0,0,0)),e=t.take().eventDriven("build/sprites/ghost.png",72,72,128,128,1,0,0,0),o=t.take().eventDriven("build/sprites/tap.png",90,90,64,64,2,3,0,0);o.animationEndEvent=o.resetAnimation;let r,s,a,h,l,c,d=t.take().tiled("build/sprites/grassland-tile.jpg",n,i,414,307,0,0,1,2),u=t.take().eventDriven("build/sprites/bigx.png",90,90,128,128,1,0,0,0),p=t.take().eventDriven("build/sprites/check.png",90,90,128,128,1,0,0,0),f=t.take().eventDriven("build/sprites/grave.png",90,90,128,128,1,0,0,0),g=i/2-i/4,m=t.take().eventDriven("build/sprites/fog.png",n,g,438,266,1,0,0,0);return r=new(window.AudioContext||window.webkitAudioContext),h=1,l=.1,c=.15,(s=r.createGain()).gain.value=l,(a=r.createGain()).gain.value=c,{spr_enemy:function(){return t.take().copyAttributes(e)},spr_tapIcon:function(){return t.take().copyAttributes(o)},spr_tiledGrass:function(){return t.take().copyAttributes(d)},spr_bigX:function(){return t.take().copyAttributes(u)},spr_check:function(){return t.take().copyAttributes(p)},spr_grave:function(){return t.take().copyAttributes(f)},spr_fog:function(){return t.take().copyAttributes(m)},snd_valid:new z("audio/ding",r,a),snd_error:new z("audio/error",r,a),snd_bgm:new z("audio/bgm",r,s,!0),initVolume:function(){let t;if("undefined"!=typeof Storage){try{t=JSON.parse(localStorage.getItem("nback_masterVolume"))}catch(t){console.log("Previous volume data is corrupted or missing.")}if(t||0===t)return h=t,this.setMasterVolume(t),t}return null},setMasterVolume:function(){if(h=vol,a.gain.value=c*vol,s.gain.value=l*vol,"undefined"!=typeof Storage)try{localStorage.setItem("nback_masterVolume",JSON.stringify(h))}catch(t){console.log("Error: an issue occurred when saving volume data.")}},putSpriteBack:function(e){let i;for(i=e.layers.length;i>=0;i--)t.putBack(e.layers[i]);t.putBack(e)}}}(),j=function(){const t=document.getElementById("bar-label"),n=document.getElementById("start-button"),o=document.getElementById("lives");let r=e.getCanvas(),s=r.getContext("2d",{alpha:!1}),a=0,h=0,l=[];function c(t,e,i){let n,o=t.layers,r=t;for(n=0;n<=o.length;n++)t=o[n],n===o.length&&(t=r),t.draw&&(t.frameRate<=0||t.currentFrame>=t.frames)?(s.save(),s.globalAlpha=t.alpha,s.drawImage(t.image,t.width*(t.frames-1),0,t.width,t.height,e,i,t.width,t.height),s.restore()):t.draw&&(s.save(),s.globalAlpha=t.alpha,s.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,e,i,t.width,t.height),s.restore())}let d=function(){let t=0,e=G.spr_tiledGrass();return function(){c(e,0,t-i),c(e,0,t),V.accelerating()&&!V.gameOver()&&(t=(t+20)%i)}}();return{render:function(e){let i,r,s=V.entities(),u=s.length;for(d(),function(e=!1){let i,r,s,l,c;if(V&&!V.started())n.style.display="block";else if(V&&(n.style.display="none",i=V.player().life,r=V.score(),(h!==r||e)&&(h=r,t.textContent="Score: "+r),a!==i||e)){for(a=i,c=0;c<o.childNodes.length;c++)o.removeChild(o.childNodes[c]),c--;for(c=0;c<i;c++)s=document.createElementNS("http://www.w3.org/2000/svg","svg"),(l=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#heart"),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#heart"),s.appendChild(l),o.appendChild(s)}}(),r=0;r<u;r++)(i=s[r]).sprite&&((V.accelerating()||i instanceof D||0!==i.sprite.fadeAmt)&&i.sprite.update(e),i.sprite.foreground?l.push(i):c(i.sprite,i instanceof D?i.x+i.width/4:i.x,i.y));for(r=0;r<l.length;r++)c((i=l[r]).sprite,i.x,i.y);l.length=0},canvas:r}}(),V=function(){let t,e,o,r,s,a,h,l,c,d,u,p,f,g,m,y,w=new _(new D(0,0,0,0,null)),v=new _(new H(0,0,0,0,null)),b=20,E=i-i/5,k=i/4,x=i-i/3,L=!1,I=1,F=function(){const t=6;let e,i=[];for(e=0;e<t;e++)i.push(n*(e/t));return{NUM_LANES:t,getLaneByLocation:function(n){for(e=t;e>=0;e--)if(n>i[e])return e;return-1},getCenterX:function(t){return i[t]}}}(),R=function(){let t,e,o,r,s,a,h,l,c,d;return{init:function(){t=0,o=[],r=0,s=0,a=[],h=0,l=new O(-n,-i,0,0,G.spr_fog()),c=new O(-n,-i,0,0,G.spr_fog()),d=new O(-n,-i,0,0,G.spr_fog()),l.sprite.foreground=!0,c.sprite.foreground=!0,d.sprite.foreground=!0,C(l),C(c),C(d),e=2*i},updateWavesPassed:function(){r++},showTutorial:function(){if(h<a.length&&a[h].wave===r){let t;(t=w.take()).x=F.getCenterX(a[h++].lane),t.y=E,t.sprite=G.spr_tapIcon(),t.width=t.sprite.width,t.height=t.sprite.height,C(t)}},spawn:function(){let n,h,u,p,f=!1;switch(r){case 4:l.x=0,l.y=e-k+20,l.sprite.alpha=0,l.sprite.fadeAmt=.04;break;case 18:case 78:c.x=0,c.y=e-k+130,c.sprite.alpha=0,c.sprite.fadeAmt=.04;break;case 33:case 118:d.x=0,d.y=e-k+130,d.sprite.alpha=0,d.sprite.fadeAmt=.04;break;case 58:c.sprite.fadeAmt=-.04,d.sprite.fadeAmt=-.04}switch(s){case 0:case 1:case 2:f=!0;break;case 5:case 6:case 7:t=1,e=.75*i,f=!0;break;case 20:e=i/2;break;case 35:e=i/3;break;case 60:t=2,e=.75*i;break;case 80:e=i/2;break;case 130:e=i/3;break;case 200:t=3,e=.75*i;break;case 220:e=i/2;break;case 330:e=i/3;break;default:s>350&&(e=i/5)}for(u=P(F.NUM_LANES-t),p=0;p<=t;p++)(n=v.take()).lane=u+p,n.x=F.getCenterX(u+p),n.y=-10,n.speed=b,n.invisPointY=e,n.sprite=G.spr_grave(),n.width=n.sprite.width,n.height=n.sprite.width,n.isFake=!0,o[p]=n,C(n);h=o[P(o.length)],G.putSpriteBack(h.sprite),h.sprite=G.spr_enemy(),h.sprite.addLayer(G.spr_grave()),h.isFake=!1,h.sprite.draw=!0,f&&a.push({lane:h.lane,wave:s}),s++},wavesPassed:function(){return r}}}();function B(){l=!l}function A(){h=!h}function C(e){e instanceof N?s=e:e instanceof H&&o.push(e),t.push(e)}function M(e){let i,n=e.length;if(0!==n){for(i=n-1;i>=0;i--){let n,r=e[i];null!==r.sprite&&G.putSpriteBack(r.sprite),(n=t.indexOf(r))>=0&&S(t,n),(n=o.indexOf(r))>=0&&(S(o,n),v.putBack(r)),r instanceof D&&w.putBack(r)}e.includes(s)&&(s=void 0)}}function T(){d=!d}let W=function(){const t=1500;let e,i=!1,n=0,o=3;function r(){I=1,n=0,o=3,i=!1}return{start:function(){i=!0,e=window.setTimeout(r,t)},stop:function(){i&&(window.clearTimeout(e),i=!1,1==(n=(n+1)%o)&&(o+=2,I+=.5))},reset:r}}();return{start:function(){if(t&&M(t),t=[],o=[],r=[],e=[],u=!1,h=!0,l=!1,c=!1,d=!1,g=0,m=0,a=0,R.init(),"undefined"!=typeof Storage){try{y=JSON.parse(localStorage.getItem("nback_scores"))}catch(t){y=[]}null===y&&(y=[])}C(s=new N(-100,-100,null)),R.spawn(),L||(L=!0,p=this.update.bind(this),f&&window.cancelAnimationFrame(f),window.requestAnimationFrame(p))},update:function(n){let o,s,d,g=!1,m=t.length,y=Math.min((n-a)/1e3,.05);if(a=n,u)return j.render(y),L=!1,void(f=window.requestAnimationFrame(p));for(d=0;d<m;d++)s=(o=t[d]).invisPointY-k,h&&o.update(y),o instanceof H&&o.y>=x&&!o.clicked&&r.indexOf(o)<0&&r.push(o),o.y>i?(e.push(o),o instanceof H&&!o.isFake&&l&&B()):o instanceof H&&!o.isFake&&o.y>=s&&o.y<o.invisPointY?o.sprite.alpha=1-(o.y-s)/(o.invisPointY-s):o instanceof H&&!o.isFake&&o.y>=o.invisPointY&&!o.clicked&&(o.sprite.draw=!1),o instanceof H&&!o.isFake&&o.y>=k&&!o.triggeredWave&&(R.spawn(),o.triggeredWave=!0),h&&!l&&o instanceof H&&o.y>=E&&!o.triggeredPause&&(g=!0,o.triggeredPause=!0),c&&o instanceof D&&e.push(o);g&&(A(),B(),R.showTutorial(),T(),W.start()),c&&(c=!1),M(e),e.length=0,j.render(y),window.requestAnimationFrame(p)},setGameOver:function(){var t;u||(u=!0,t=Math.round(g),y.push(t),y.sort(function(t,e){return e-t}),y=y.slice(0,10),"undefined"!=typeof Storage&&localStorage.setItem("nback_scores",JSON.stringify(y)))},addScore:function(t){(m=(g+=t*I+m)%1)>0&&(g-=m)},toggleAcceleration:A,toggleInputBuffer:B,setInputEventFired:function(){c=!0},lanes:F,addEntity:C,clickZone:x,updateWavesPassed:R.updateWavesPassed,toggleInput:T,inputTimer:W,stoppingThreshold:E,inputEnabled:function(){return d},accelerating:function(){return h},inputBuffered:function(){return l},started:function(){return L},gameOver:function(){return u},entities:function(){return t},enemies:function(){return o},player:function(){return s},frontRowEnemies:function(){return r},score:function(){return g}}}();function Y(t){if(!V.started())return;let n,o,a,h,l=V.clickZone,c=null,d=V.frontRowEnemies(),u=V.player(),p=d.length,f=0,g=0;if("touchstart"===t.type?n=e.getRelativeEventCoords(t.changedTouches[0]):"mousedown"===t.type&&(n=e.getRelativeEventCoords(t)),!V.gameOver()&&u&&V.inputEnabled()&&n.y>=l){for(s.x=n.x-r/2,s.y=V.stoppingThreshold,s.height=i-V.stoppingThreshold,a=0;a<p;a++)(f=(h=(o=d[a]).collisionRect()).intersection(s).getArea())>g&&(g=f,o.clicked=!0,c=o);g>0&&(V.toggleInput(),G.putSpriteBack(c.sprite),c.isFake?(c.sprite=G.spr_bigX(),u.loseLife(),V.inputTimer.reset(),G.snd_error.play()):(c.sprite=G.spr_check(),u.addLife(),V.inputTimer.stop(),G.snd_valid.play()),V.setInputEventFired(),V.accelerating()?V.inputBuffered()||V.toggleInputBuffer():V.toggleAcceleration(),d.length=0,V.updateWavesPassed())}}j.canvas.addEventListener("touchstart",function(t){"mousedown"===a?Date.now()-h>1e3&&(a=t.type,h=Date.now(),Y(t)):(a=t.type,h=Date.now(),Y(t))}),j.canvas.addEventListener("mousedown",function(t){"touchstart"===a?Date.now()-h>1e3&&(a=t.type,h=Date.now(),Y(t)):(a=t.type,h=Date.now(),Y(t))}),document.getElementById("start-button").addEventListener("click",function(){V.start()}),document.body.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),e.addResizeEvent(function(){let t,e;e=l.style.display,l.style.display="",t=l.clientHeight,l.style.display=e,o=1.2*t,c.style.height=o+"px",c.style.width=o+"px",d.style.height=o+"px",d.style.width=o+"px"}),e.resize(),u.addEventListener("click",function(){C(f)},!1),g.addEventListener("click",function(){var t;(t=f).classList.remove("center-popout"),t.classList.add("center-popin"),R.classList.remove("partial-fade-in"),R.classList.add("partial-fade-out"),l.style.display=""},!1),m.addEventListener("click",A,!1),y.addEventListener("click",A,!1),w.addEventListener("click",A,!1),v.addEventListener("click",A,!1),b.addEventListener("click",function(){M(f,E)},!1),p.addEventListener("click",function(){C(E)},!1),x.addEventListener("click",B,!1),L.addEventListener("click",B,!1),k.addEventListener("click",function(){M(E,f)},!1),F.addEventListener("click",function(){M(I,f)},!1)}();