!function(){"use strict";const t=960,e=540;let i=32,n=new c(-1*i,-1*i,i,i+10),r=null,s=null;function o(t){return Math.floor(Math.random()*Math.floor(t))}function a(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t[t.length-1]=void 0,t.length=t.length-1)}function h(t){this.template=t,this.pool=[]}function c(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function l(t,e,i,n,r){this.width=e,this.height=i,this.frames=n,this.frameRate=r,this.timer=0,this.currentFrame=0,this.image=t,this.animationEndEvent=null,this.layers=[],this.draw=!0,this.foreground=!1,this.alpha=1,this.fadeAmt=0}function u(t,e,i,n,r){this.x=t,this.y=e,this.xFraction=0,this.yFraction=0,this.time=0,this.width=i,this.height=n,this.sprite=r,this.hitbox=new c(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function d(t,e,i,n,r){u.call(this,t,e,i,n,r)}function p(t,e,i){let n=0,r=0;i&&(n=i.width,r=i.height),u.call(this,t,e,n,r,i),this.maxLife=3,this.life=this.maxLife}function f(t,e,i,n,r){let s=0,o=0;r&&(s=r.width,o=r.height),u.call(this,t,e,s,o,r),this.invisPointY=n,this.speed=i,this.isFake=!1,this.lane=1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1}function g(t,e,i,n=!1){let r,s,o=this;if(this.buffer=null,this.audioContext=e,this.gainNode=i,this.loop=n,(r=document.createElement("audio")).canPlayType)if(r.canPlayType&&""!==r.canPlayType("audio/mp4"))t+=".mp4";else{if(!r.canPlayType||""===r.canPlayType('audio/ogg; codecs="vorbis"'))return void console.log("Error: MP4 and OGG files are unsupported on this device.");t+=".ogg"}(s=new XMLHttpRequest).open("GET",encodeURI(t),!0),s.responseType="arraybuffer",s.addEventListener("error",function(){console.log("Error loading from server: "+t)},!1),s.addEventListener("load",function(){e.decodeAudioData(s.response,function(t){o.buffer=t},function(t){console.log("Error decoding audio data: "+t.err)})},!1),s.send()}h.prototype.take=function(){let t,e,i=this.pool.length,n=null;for(e=0;e<i;e++)if((n=this.pool[e]).available)return n.available=!1,n.object.init(),n.object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},h.prototype.putBack=function(t){let e,i,n=this.pool.length;for(i=0;i<n;i++)if((e=this.pool[i]).object===t)return void(e.available=!0)},c.prototype.left=function(){return this.x},c.prototype.right=function(){return this.x+this.width},c.prototype.top=function(){return this.y},c.prototype.bottom=function(){return this.y+this.height},c.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},c.prototype.contains=function(t,e){return this.left()<=t&&t<=this.right()&&this.bottom()<=e&&e<=this.top()},c.prototype.union=function(t){let e,i,n,r;if(void 0!==t)return e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),r=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=r,this},c.prototype.intersection=function(t){let e,i,n,r;return e=Math.max(this.left(),t.left()),r=Math.min(this.bottom(),t.bottom()),i=Math.min(this.right(),t.right()),n=Math.max(this.top(),t.top()),e>i||r<n?(this.x=-1,this.y=-1,this.width=0,this.height=0):(this.x=e,this.y=n,this.width=i-e,this.height=r-n),this},c.prototype.getArea=function(){return this.height*this.width},l.prototype.eventDriven=function(t,e,i,n,r,s,o,a,h){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function t(){let o=document.createElement("canvas"),u=o.getContext("2d");o.width=e*s,o.height=i,u.drawImage(c,h*n,a*r,n*s,r,0,0,e*s,i),l.src=o.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.frames=s,this.frameRate=o,this.image=l,this},l.prototype.tiled=function(t,e,i,n,r,s,o,a,h){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function t(){let u,d,p=document.createElement("canvas"),f=p.getContext("2d");for(p.width=e,p.height=i,u=0;u<a;u++)for(d=0;d<h;d++)f.drawImage(c,o*n,s*r,n,r,u*e/a,d*i/h,e/a,i/h);l.src=p.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.frameRate=0,this.frames=1,this.image=l,this},l.prototype.resetAnimation=function(){this.currentFrame=0},l.prototype.update=function(t){let e;var i,n,r;for(this.alpha=(i=this.alpha+this.fadeAmt,n=0,r=1,Math.min(Math.max(i,n),r)),e=0;e<this.layers.length;e++)this.layers[e].update(t);this.frameRate>0&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame++,this.currentFrame>this.frames-1&&null!==this.animationEndEvent&&this.animationEndEvent()))},l.prototype.init=function(){this.width=0,this.height=0,this.frameRate=0,this.frames=0,this.currentFrame=0,this.timer=0,this.alpha=1,this.fadeAmt=0,this.layers.length=0,this.image=null,this.animationEndEvent=null,this.draw=!0,this.foreground=!1},l.prototype.clone=function(){return new l(this.image,this.width,this.height,this.frames,this.frameRate)},l.prototype.copyAttributes=function(t){return this.width=t.width,this.height=t.height,this.frameRate=t.frameRate,this.frames=t.frames,this.image=t.image,this.animationEndEvent=t.animationEndEvent,this.draw=t.draw,this.alpha=t.alpha,this.fadeAmt=t.fadeAmt,this.foreground=t.foreground,this},l.prototype.addLayer=function(t){this.layers.push(t)},u.prototype.init=function(){this.x=0,this.y=0,this.xFraction=0,this.yFraction=0,this.time=0,this.sprite=null},u.prototype.clone=function(){return new u(this.x,this.y,this.width,this.height,this.sprite)},u.prototype.update=function(t){let e=this.x,i=this.y,n=this.xFraction,r=this.yFraction;this.time+=t,e+=n,i+=r,e-=n=e%1,i-=r=i%1,this.x=e,this.y=i,this.xFraction=n,this.yFraction=r},u.prototype.collisionRect=function(){return this.hitbox.x=this.x,this.hitbox.y=this.y,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},u.prototype.isCollidingWith=function(t){let e=this.collisionRect(),i=t.collisionRect();return e.intersects(i)},d.prototype=Object.create(u.prototype),d.prototype.init=function(){u.prototype.init.call(this)},d.prototype.clone=function(){return new d(this.x,this.y,this.width,this.height,this.sprite)},p.prototype=Object.create(u.prototype),p.prototype.update=function(t){u.prototype.update.call(this,t),w.addScore(1)},p.prototype.addLife=function(){this.life+=1,this.life>=this.maxLife&&(this.life=this.maxLife)},p.prototype.loseLife=function(){this.life-=1,this.life<=0&&w.setGameOver()},p.prototype.move=function(t,e){this.x=t,this.y=e},f.prototype=Object.create(u.prototype),f.prototype.init=function(){u.prototype.init.call(this),this.x=-100,this.y=-100,this.invisPointY=0,this.speed=0,this.lane=1,this.isFake=!1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1},f.prototype.clone=function(){return new f(this.x,this.y,this.speed,this.invisPointY,this.sprite)},f.prototype.update=function(t){u.prototype.update.call(this,t),this.y+=this.speed},g.prototype.play=function(){let t=this;if(this.buffer){let t=this.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gainNode).connect(this.audioContext.destination),t.start(0),t.loop=this.loop}else window.setTimeout(function(){t.play()},50)};let m=function(){let i=new h(new l(null,0,0,0,0)),n=i.take().eventDriven("build/sprites/ghost.png",72,72,128,128,1,0,0,0),r=i.take().eventDriven("build/sprites/tap.png",90,90,64,64,2,3,0,0);r.animationEndEvent=r.resetAnimation;let s,o,a,c,u,d,p=i.take().tiled("build/sprites/grassland-tile.jpg",e,t,414,307,0,0,1,2),f=i.take().eventDriven("build/sprites/bigx.png",90,90,128,128,1,0,0,0),m=i.take().eventDriven("build/sprites/collar.png",128,128,128,128,1,0,0,0),y=i.take().eventDriven("build/sprites/check.png",90,90,128,128,1,0,0,0),w=i.take().eventDriven("build/sprites/grave.png",90,90,128,128,1,0,0,0),v=t/2-t/4,b=i.take().eventDriven("build/sprites/fog.png",e,v,438,266,1,0,0,0);return s=new(window.AudioContext||window.webkitAudioContext),c=1,u=.1,d=.15,(o=s.createGain()).gain.value=.1,(a=s.createGain()).gain.value=.15,{spr_enemy:function(){return i.take().copyAttributes(n)},spr_tapIcon:function(){return i.take().copyAttributes(r)},spr_tiledGrass:function(){return i.take().copyAttributes(p)},spr_bigX:function(){return i.take().copyAttributes(f)},spr_collar:function(){return i.take().copyAttributes(m)},spr_check:function(){return i.take().copyAttributes(y)},spr_grave:function(){return i.take().copyAttributes(w)},spr_fog:function(){return i.take().copyAttributes(b)},snd_valid:new g("audio/ding",s,a),snd_error:new g("audio/error",s,a),snd_bgm:new g("audio/bgm",s,o,!0),initVolume:function(){let t;if("undefined"!=typeof Storage){try{t=JSON.parse(localStorage.getItem("nback_masterVolume"))}catch(t){console.log("Previous volume data is corrupted or missing.")}if(t||0===t)return c=t,this.setMasterVolume(t),t}return null},setMasterVolume:function(t){if(c=t,a.gain.value=.15*t,o.gain.value=.1*t,"undefined"!=typeof Storage)try{localStorage.setItem("nback_masterVolume",JSON.stringify(c))}catch(t){console.log("Error: an issue occurred when saving volume data.")}},putSpriteBack:function(t){let e;for(e=t.layers.length;e>=0;e--)i.putBack(t.layers[e]);i.putBack(t)}}}(),y=function(){const i=navigator.userAgent.toLowerCase(),n=i.indexOf("android")>-1,r=/ipad|iphone|ipod/i.test(i)&&!window.MSStream;let s,o=document.getElementById("start_button"),a=document.getElementById("gameWindow"),h=a.getContext("2d",{alpha:!1}),c=t,l=e,u=[];function p(){let i=e/t,o=document.getElementById("container"),h=document.getElementById("overlay");document.getElementById("widebar");c=window.innerHeight,l=c*i,s=document.getElementById("lives-overlay"),h.style.display="initial",h.style.position="absolute",h.style.height="8%",document.body.style.height=n||r?window.innerHeight+50+"px":window.innerHeight+"px",Math.floor(l)>window.innerWidth&&(i=t/e,l=window.innerWidth,c=l*i,h.style.height=window.innerHeight-c+"px",h.style.position="fixed"),a.style.width=l+"px",a.style.height=c+"px",o.style.width=l+"px",o.style.height=c+"px",o.style.marginLeft="-"+l/2+"px",window.setTimeout(function(){window.scrollTo(0,1)},1),y(!0)}function f(t,e,i){let n,r=t.layers,s=t;for(n=0;n<=r.length;n++)t=r[n],n===r.length&&(t=s),t.draw&&(t.frameRate<=0||t.currentFrame>=t.frames)?(h.save(),h.globalAlpha=t.alpha,h.drawImage(t.image,t.width*(t.frames-1),0,t.width,t.height,e,i,t.width,t.height),h.restore()):t.draw&&(h.save(),h.globalAlpha=t.alpha,h.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,e,i,t.width,t.height),h.restore())}a.width=e,a.height=t,window.addEventListener("load",p,!1),window.addEventListener("resize",function(t,e,i){let n;return function(){let r=this,s=arguments,o=i&&!n;clearTimeout(n),n=window.setTimeout(function(){n=null,i||t.apply(r,s)},e),o&&t.apply(r,s)}}(p,250,!1),!1);let g=function(){let e=0,i=m.spr_tiledGrass();return function(){f(i,0,e-t),f(i,0,e),w.accelerating()&&!w.gameOver()&&(e=(e+20)%t)}}(),y=function(){const t=m.spr_collar(),e=document.getElementById("score");let i=0,n=0;return function(r=!1){let a,h,c;if(w&&!w.started())o.style.display="block";else if(w&&(o.style.display="none",a=w.player().life,h=w.score(),(n!==h||r)&&(n=h,e.textContent="Score: "+h),i!==a||r)){for(i=a,c=0;c<s.childNodes.length;c++)s.childNodes[c]instanceof Image&&(s.removeChild(s.childNodes[c]),c--);for(c=0;c<a;c++){let e=document.createElement("img");e.src=t.image.src,e.className="life",s.appendChild(e)}}}}();return{render:function(t){let e,i,n=w.entities(),r=n.length;for(g(),y(),i=0;i<r;i++)(e=n[i]).sprite&&((w.accelerating()||e instanceof d||0!==e.sprite.fadeAmt)&&e.sprite.update(t),e.sprite.foreground?u.push(e):f(e.sprite,e instanceof d?e.x+e.width/4:e.x,e.y));for(i=0;i<u.length;i++)f((e=u[i]).sprite,e.x,e.y);u.length=0},canvas:a,isIOS:function(){return r},currentWidth:function(){return l}}}(),w=function(){const i=Object.freeze({single:1,clones:2,graves:3});let n,r,s,c,l,g,w,v,b,k,x,E,L,_,A,F,M=new h(new d(0,0,0,0,null)),I=new h(new f(0,0,0,0,null)),S=t-t/5,T=t/4,P=t-t/3,R=!1,B=i.graves,N=1,O=function(){const t=6;let i,n=[];for(i=0;i<t;i++)n.push(e*(i/t));return{NUM_LANES:t,getLaneByLocation:function(e){for(i=t;i>=0;i--)if(e>n[i])return i;return-1},getCenterX:function(t){return n[t]}}}(),D=function(){let n,r,s,a,h,c,l,d,p,f,g;let y=function(){let e,i,l,u,d=!1;switch(console.log(a),a){case 4:p.x=0,p.y=r-T+20,p.sprite.alpha=0,p.sprite.fadeAmt=.04;break;case 18:case 78:f.x=0,f.y=r-T+130,f.sprite.alpha=0,f.sprite.fadeAmt=.04;break;case 33:case 118:g.x=0,g.y=r-T+130,g.sprite.alpha=0,g.sprite.fadeAmt=.04;break;case 58:f.sprite.fadeAmt=-.04,g.sprite.fadeAmt=-.04}switch(h){case 0:case 1:case 2:d=!0;break;case 5:case 6:case 7:n=1,r=.75*t,d=!0;break;case 20:r=t/2;break;case 35:r=t/3;break;case 60:n=2,r=.75*t;break;case 80:r=t/2;break;case 130:r=t/3;break;case 200:n=3,r=.75*t;break;case 220:r=t/2;break;case 330:r=t/3;break;default:h>350&&(r=t/5)}for(l=o(O.NUM_LANES-n),u=0;u<=n;u++)(e=I.take()).lane=l+u,e.x=O.getCenterX(l+u),e.y=-10,e.speed=20,e.invisPointY=r,e.sprite=m.spr_grave(),e.width=e.sprite.width,e.height=e.sprite.width,e.isFake=!0,s[u]=e,Y(e);i=s[o(s.length)],m.putSpriteBack(i.sprite),i.sprite=m.spr_enemy(),i.sprite.addLayer(m.spr_grave()),i.isFake=!1,i.sprite.draw=!0,d&&c.push({lane:i.lane,wave:h}),h++},w=function(){let e,i,n=!1;switch(h){case 0:case 1:case 2:n=!0;break;case 5:case 6:case 7:r=.75*t,n=!0;break;case 20:r=t/2;break;case 35:r=t/3;break;case 80:r=.75*t;break;case 100:r=t/2;break;case 140:r=t/3;break;case 220:r=.75*t;break;case 240:r=t/2;break;case 350:r=t/3;break;default:h>350&&(r=t/5)}i=o(O.NUM_LANES),(e=I.take()).lane=i,e.x=O.getCenterX(i),e.y=-10,e.speed=20,e.invisPointY=r,e.sprite=m.spr_enemy(),e.width=e.sprite.width,e.height=e.sprite.height,e.isFake=!1,Y(e),n&&c.push({lane:i,wave:h}),h++},v=function(){let e,i,a,l,u=!1;switch(h){case 0:case 1:case 2:u=!0;break;case 5:case 6:case 7:n=1,r=.75*t,u=!0;break;case 20:r=t/2;break;case 35:r=t/3;break;case 80:n=2,r=.75*t;break;case 100:r=t/2;break;case 140:r=t/3;break;case 220:n=3,r=.75*t;break;case 240:r=t/2;break;case 350:r=t/3;break;default:h>350&&(r=t/5)}for(a=o(O.NUM_LANES-n),l=0;l<=n;l++)(e=I.take()).lane=a+l,e.x=O.getCenterX(a+l),e.y=-10,e.speed=20,e.invisPointY=r,e.sprite=m.spr_enemy(),e.width=e.sprite.width,e.height=e.sprite.height,e.sprite.draw=!1,e.isFake=!0,s[l]=e,Y(e);(i=s[o(s.length)]).isFake=!1,i.sprite.draw=!0,u&&c.push({lane:i.lane,wave:h}),h++};return{init:function(){switch(n=0,s=[],a=0,h=0,c=[],l=0,p=new u(-e,-t,0,0,m.spr_fog()),f=new u(-e,-t,0,0,m.spr_fog()),g=new u(-e,-t,0,0,m.spr_fog()),p.sprite.foreground=!0,f.sprite.foreground=!0,g.sprite.foreground=!0,Y(p),Y(f),Y(g),r=2*t,B){case i.single:d=w;break;case i.clones:d=v;break;case i.graves:d=y}},updateWavesPassed:function(){a++},showTutorial:function(){if(l<c.length&&c[l].wave===a){let t;(t=M.take()).x=O.getCenterX(c[l++].lane),t.y=S,t.sprite=m.spr_tapIcon(),t.width=t.sprite.width,t.height=t.sprite.height,Y(t)}},spawn:function(){d()},wavesPassed:function(){return a}}}();function C(){v=!v}function W(){w=!w}function Y(t){t instanceof p?l=t:t instanceof f&&s.push(t),n.push(t)}function H(t){let e,i=t.length;if(0!==i){for(e=i-1;e>=0;e--){let i,r=t[e];null!==r.sprite&&m.putSpriteBack(r.sprite),(i=n.indexOf(r))>=0&&a(n,i),(i=s.indexOf(r))>=0&&(a(s,i),I.putBack(r)),r instanceof d&&M.putBack(r)}t.includes(l)&&(l=void 0)}}function X(){k=!k}let j=function(){const t=1500;let e,i=!1,n=0,r=3;function s(){N=1,n=0,r=3,i=!1,console.log("Multiplier reset to 1.")}return{start:function(){i=!0,e=window.setTimeout(s,t)},stop:function(){i&&(window.clearTimeout(e),i=!1,1==(n=(n+1)%r)&&(r+=2,N+=.5,console.log(N+"x multipler!")))},reset:s}}();return{start:function(){if(n&&H(n),n=[],s=[],c=[],r=[],x=!1,w=!0,v=!1,b=!1,k=!1,_=0,A=0,g=0,D.init(),"undefined"!=typeof Storage){try{F=JSON.parse(localStorage.getItem("nback_scores"))}catch(t){F=[]}null===F&&(F=[])}Y(l=new p(-100,-100,null)),D.spawn(),R||(R=!0,E=this.update.bind(this),L&&window.cancelAnimationFrame(L),window.requestAnimationFrame(E))},update:function(e){let s,o,a,h=!1,l=n.length,u=Math.min((e-g)/1e3,.05);if(g=e,x)return y.render(u),R=!1,void(L=window.requestAnimationFrame(E));for(a=0;a<l;a++){if(o=(s=n[a]).invisPointY-T,w&&s.update(u),s instanceof f&&s.y>=P&&!s.clicked&&c.indexOf(s)<0&&c.push(s),s.y>t)r.push(s),s instanceof f&&!s.isFake&&v&&C();else if(s instanceof f&&(B===i.clones&&s.isFake||B===i.single||B===i.graves&&!s.isFake)&&s.y>=o&&s.y<s.invisPointY)B===i.graves?s.sprite.alpha=1-(s.y-o)/(s.invisPointY-o):s.sprite.draw=!s.sprite.draw;else if(s instanceof f&&(B===i.clones&&s.isFake||B===i.single||B===i.graves&&!s.isFake)&&s.y>=s.invisPointY&&!s.clicked)switch(B){case i.single:case i.graves:s.sprite.draw=!1;break;case i.clones:s.sprite.draw=!0}s instanceof f&&!s.isFake&&s.y>=T&&!s.triggeredWave&&(D.spawn(),s.triggeredWave=!0),w&&!v&&s instanceof f&&s.y>=S&&!s.triggeredPause&&(h=!0,s.triggeredPause=!0),b&&s instanceof d&&r.push(s)}h&&(W(),C(),D.showTutorial(),X(),j.start()),b&&(b=!1),H(r),r.length=0,y.render(u),window.requestAnimationFrame(E)},setGameOver:function(){var t;x||(x=!0,t=Math.round(_),F.push(t),F.sort(function(t,e){return e-t}),F=F.slice(0,10),"undefined"!=typeof Storage&&localStorage.setItem("nback_scores",JSON.stringify(F)))},addScore:function(t){(A=(_+=t*N+A)%1)>0&&(_-=A)},toggleAcceleration:W,toggleInputBuffer:C,setInputEventFired:function(){b=!0},lanes:O,addEntity:Y,clickZone:P,updateWavesPassed:D.updateWavesPassed,toggleInput:X,inputTimer:j,spawnMode:B,easyAccuracy:!1,stoppingThreshold:S,inputEnabled:function(){return k},accelerating:function(){return w},inputBuffered:function(){return v},started:function(){return R},gameOver:function(){return x},entities:function(){return n},enemies:function(){return s},player:function(){return l},frontRowEnemies:function(){return c},score:function(){return _}}}();function v(t){if(!w.started())return;let e,r,s,o,a=w.clickZone,h=null,c=w.frontRowEnemies(),l=w.player(),u=c.length,d=0,p=0;if("touchstart"===t.type?e=b(t.changedTouches[0]):"mousedown"===t.type&&(e=b(t)),!w.gameOver()&&l&&w.inputEnabled()&&e.y>=a){for(n.x=e.x-i/2,n.y=e.y-i/2,w.easyAccuracy&&(n.x=w.lanes.getCenterX(w.lanes.getLaneByLocation(e.x)),n.y=w.stoppingThreshold,n.height=64,n.width=1),s=0;s<u;s++)(d=(o=(r=c[s]).collisionRect()).intersection(n).getArea())>p&&(p=d,r.clicked=!0,h=r);p>0&&(w.toggleInput(),m.putSpriteBack(h.sprite),h.isFake?(h.sprite=m.spr_bigX(),l.loseLife(),w.inputTimer.reset(),m.snd_error.play()):(h.sprite=m.spr_check(),l.addLife(),w.inputTimer.stop(),m.snd_valid.play()),w.setInputEventFired(),w.accelerating()?w.inputBuffered()||w.toggleInputBuffer():w.toggleAcceleration(),c.length=0,w.updateWavesPassed())}}function b(t){let i=y.currentWidth()/e;return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(y.canvas))/i,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(y.canvas))/i}}function k(t,e){let i=e.value;i=Number(i),y.isIOS()&&(i<=0?(i=1,e.value="1"):(i=0,e.value="0")),t.innerHTML=i<=0?"volume_mute":"volume_up",m.setMasterVolume(i)}y.canvas.addEventListener("touchstart",function(t){"mousedown"===r?Date.now()-s>1e3&&(r=t.type,s=Date.now(),v(t)):(r=t.type,s=Date.now(),v(t))}),y.canvas.addEventListener("mousedown",function(t){"touchstart"===r?Date.now()-s>1e3&&(r=t.type,s=Date.now(),v(t)):(r=t.type,s=Date.now(),v(t))});let x=document.querySelector("#overlay-volume~.slider"),E=document.querySelector("#widebar-volume~.slider"),L=document.querySelector("#overlay-volume+label>i"),_=document.querySelector("#widebar-volume+label>i");document.getElementById("overlay-volume").checked=!1,document.getElementById("widebar-volume").checked=!1,x.addEventListener("mouseup",function(t){k(L,x)}),E.addEventListener("mouseup",function(t){k(_,E)}),y.isIOS()?(x.style.visibility="hidden",E.style.visibility="hidden",L.addEventListener("touchend",function(t){t.preventDefault(),k(L,x)}),_.addEventListener("touchend",function(t){t.preventDefault(),k(_,E)})):(x.addEventListener("touchend",function(t){t.preventDefault(),k(L,x)}),E.addEventListener("touchend",function(t){t.preventDefault(),k(_,E)})),document.getElementById("start_button").addEventListener("click",function(){m.snd_bgm.play(),w.start()}),document.body.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),window.addEventListener("load",function(){let t=m.initVolume();0===t?(L.innerHTML="volume_mute",_.innerHTML="volume_mute"):t&&(L.innerHTML="volume_up",_.innerHTML="volume_up"),document.getElementById("container").style.display="block"},!1)}();