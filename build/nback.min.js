!function(){"use strict";function t(t){return Math.floor(Math.random()*Math.floor(t))}function e(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t[t.length-1]=void 0,t.length=t.length-1)}function i(t){this.template=t,this.pool=[]}function n(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function r(t,e,i,n,r){this.width=e,this.height=i,this.frames=n,this.frameRate=r,this.timer=0,this.currentFrame=0,this.image=t,this.animationEndEvent=null,this.layers=[],this.draw=!0,this.foreground=!1,this.alpha=1,this.fadeAmt=0}function s(t,e,i,r,s){this.x=t,this.y=e,this.xFraction=0,this.yFraction=0,this.time=0,this.width=i,this.height=r,this.sprite=s,this.hitbox=new n(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function o(t,e,i,n,r){s.call(this,t,e,i,n,r)}function a(t,e,i){let n=0,r=0;i&&(n=i.width,r=i.height),s.call(this,t,e,n,r,i),this.maxLife=3,this.life=this.maxLife}function h(t,e,i,n,r){let o=0,a=0;r&&(o=r.width,a=r.height),s.call(this,t,e,o,a,r),this.invisPointY=n,this.speed=i,this.isFake=!1,this.lane=1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1}function c(t,e,i,n=!1){let r,s,o=this;if(this.buffer=null,this.audioContext=e,this.gainNode=i,this.loop=n,(r=document.createElement("audio")).canPlayType)if(r.canPlayType&&""!==r.canPlayType("audio/mp4"))t+=".mp4";else{if(!r.canPlayType||""===r.canPlayType('audio/ogg; codecs="vorbis"'))return void console.log("Error: MP4 and OGG files are unsupported on this device.");t+=".ogg"}(s=new XMLHttpRequest).open("GET",encodeURI(t),!0),s.responseType="arraybuffer",s.addEventListener("error",function(){console.log("Error loading from server: "+t)},!1),s.addEventListener("load",function(){e.decodeAudioData(s.response,function(t){o.buffer=t},function(t){console.log("Error decoding audio data: "+t.err)})},!1),s.send()}i.prototype.take=function(){let t,e,i=this.pool.length,n=null;for(e=0;e<i;e++)if((n=this.pool[e]).available)return n.available=!1,n.object.init(),n.object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},i.prototype.putBack=function(t){let e,i,n=this.pool.length;for(i=0;i<n;i++)if((e=this.pool[i]).object===t)return void(e.available=!0)},n.prototype.left=function(){return this.x},n.prototype.right=function(){return this.x+this.width},n.prototype.top=function(){return this.y},n.prototype.bottom=function(){return this.y+this.height},n.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},n.prototype.contains=function(t,e){return this.left()<=t&&t<=this.right()&&this.bottom()<=e&&e<=this.top()},n.prototype.union=function(t){let e,i,n,r;if(void 0!==t)return e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),r=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=r,this},n.prototype.intersection=function(t){let e,i,n,r;return e=Math.max(this.left(),t.left()),r=Math.min(this.bottom(),t.bottom()),i=Math.min(this.right(),t.right()),n=Math.max(this.top(),t.top()),e>i||r<n?(this.x=-1,this.y=-1,this.width=0,this.height=0):(this.x=e,this.y=n,this.width=i-e,this.height=r-n),this},n.prototype.getArea=function(){return this.height*this.width},r.prototype.eventDriven=function(t,e,i,n,r,s,o,a,h){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function t(){let o=document.createElement("canvas"),u=o.getContext("2d");o.width=e*s,o.height=i,u.drawImage(c,h*n,a*r,n*s,r,0,0,e*s,i),l.src=o.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.frames=s,this.frameRate=o,this.image=l,this},r.prototype.tiled=function(t,e,i,n,r,s,o,a,h){let c=document.createElement("img"),l=document.createElement("img");return c.addEventListener("load",function t(){let u,d,p=document.createElement("canvas"),f=p.getContext("2d");for(p.width=e,p.height=i,u=0;u<a;u++)for(d=0;d<h;d++)f.drawImage(c,o*n,s*r,n,r,u*e/a,d*i/h,e/a,i/h);l.src=p.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.frameRate=0,this.frames=1,this.image=l,this},r.prototype.resetAnimation=function(){this.currentFrame=0},r.prototype.update=function(t){let e;var i,n,r;for(this.alpha=(i=this.alpha+this.fadeAmt,n=0,r=1,Math.min(Math.max(i,n),r)),e=0;e<this.layers.length;e++)this.layers[e].update(t);this.frameRate>0&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame++,this.currentFrame>this.frames-1&&null!==this.animationEndEvent&&this.animationEndEvent()))},r.prototype.init=function(){this.width=0,this.height=0,this.frameRate=0,this.frames=0,this.currentFrame=0,this.timer=0,this.alpha=1,this.fadeAmt=0,this.layers.length=0,this.image=null,this.animationEndEvent=null,this.draw=!0,this.foreground=!1},r.prototype.clone=function(){return new r(this.image,this.width,this.height,this.frames,this.frameRate)},r.prototype.copyAttributes=function(t){return this.width=t.width,this.height=t.height,this.frameRate=t.frameRate,this.frames=t.frames,this.image=t.image,this.animationEndEvent=t.animationEndEvent,this.draw=t.draw,this.alpha=t.alpha,this.fadeAmt=t.fadeAmt,this.foreground=t.foreground,this},r.prototype.addLayer=function(t){this.layers.push(t)},s.prototype.init=function(){this.x=0,this.y=0,this.xFraction=0,this.yFraction=0,this.time=0,this.sprite=null},s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.sprite)},s.prototype.update=function(t){let e=this.x,i=this.y,n=this.xFraction,r=this.yFraction;this.time+=t,e+=n,i+=r,e-=n=e%1,i-=r=i%1,this.x=e,this.y=i,this.xFraction=n,this.yFraction=r},s.prototype.collisionRect=function(){return this.hitbox.x=this.x,this.hitbox.y=this.y,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},s.prototype.isCollidingWith=function(t){let e=this.collisionRect(),i=t.collisionRect();return e.intersects(i)},o.prototype=Object.create(s.prototype),o.prototype.init=function(){s.prototype.init.call(this)},o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.sprite)},a.prototype=Object.create(s.prototype),a.prototype.update=function(t){s.prototype.update.call(this,t),f.addScore(1)},a.prototype.addLife=function(){this.life+=1,this.life>=this.maxLife&&(this.life=this.maxLife)},a.prototype.loseLife=function(){this.life-=1,this.life<=0&&f.setGameOver()},a.prototype.move=function(t,e){this.x=t,this.y=e},h.prototype=Object.create(s.prototype),h.prototype.init=function(){s.prototype.init.call(this),this.x=-100,this.y=-100,this.invisPointY=0,this.speed=0,this.lane=1,this.isFake=!1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1},h.prototype.clone=function(){return new h(this.x,this.y,this.speed,this.invisPointY,this.sprite)},h.prototype.update=function(t){s.prototype.update.call(this,t),this.y+=this.speed},c.prototype.play=function(){let t=this;if(this.buffer){let t=this.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gainNode).connect(this.audioContext.destination),t.start(0),t.loop=this.loop}else window.setTimeout(function(){t.play()},50)};const l=960,u=540;let d=function(){let t=new i(new r(null,0,0,0,0)),e=t.take().eventDriven("build/sprites/ghost.png",72,72,128,128,1,0,0,0),n=t.take().eventDriven("build/sprites/tap.png",90,90,64,64,2,3,0,0);n.animationEndEvent=n.resetAnimation;let s,o,a,h,d,p,f=t.take().tiled("build/sprites/grassland-tile.jpg",u,l,414,307,0,0,1,2),g=t.take().eventDriven("build/sprites/bigx.png",90,90,128,128,1,0,0,0),m=t.take().eventDriven("build/sprites/collar.png",128,128,128,128,1,0,0,0),y=t.take().eventDriven("build/sprites/check.png",90,90,128,128,1,0,0,0),w=t.take().eventDriven("build/sprites/grave.png",90,90,128,128,1,0,0,0),v=l/2-l/4,b=t.take().eventDriven("build/sprites/fog.png",u,v,438,266,1,0,0,0);return s=new(window.AudioContext||window.webkitAudioContext),h=1,d=.1,p=.15,(o=s.createGain()).gain.value=.1,(a=s.createGain()).gain.value=.15,{spr_enemy:function(){return t.take().copyAttributes(e)},spr_tapIcon:function(){return t.take().copyAttributes(n)},spr_tiledGrass:function(){return t.take().copyAttributes(f)},spr_bigX:function(){return t.take().copyAttributes(g)},spr_collar:function(){return t.take().copyAttributes(m)},spr_check:function(){return t.take().copyAttributes(y)},spr_grave:function(){return t.take().copyAttributes(w)},spr_fog:function(){return t.take().copyAttributes(b)},snd_valid:new c("audio/ding",s,a),snd_error:new c("audio/error",s,a),snd_bgm:new c("audio/bgm",s,o,!0),initVolume:function(){let t;if("undefined"!=typeof Storage){try{t=JSON.parse(localStorage.getItem("nback_masterVolume"))}catch(t){console.log("Previous volume data is corrupted or missing.")}if(t||0===t)return h=t,this.setMasterVolume(t),t}return null},setMasterVolume:function(t){if(h=t,a.gain.value=.15*t,o.gain.value=.1*t,"undefined"!=typeof Storage)try{localStorage.setItem("nback_masterVolume",JSON.stringify(h))}catch(t){console.log("Error: an issue occurred when saving volume data.")}},putSpriteBack:function(e){let i;for(i=e.layers.length;i>=0;i--)t.putBack(e.layers[i]);t.putBack(e)}}}(),p=function(){const t=navigator.userAgent.toLowerCase(),e=t.indexOf("android")>-1,i=/ipad|iphone|ipod/i.test(t)&&!window.MSStream;let n,r=document.getElementById("start_button"),s=document.getElementById("gameWindow"),a=s.getContext("2d",{alpha:!1}),h=l,c=u,p=[];function g(){let t=u/l,r=document.getElementById("container"),o=document.getElementById("overlay");document.getElementById("widebar");h=window.innerHeight,c=h*t,n=document.getElementById("lives-overlay"),o.style.display="initial",o.style.position="absolute",o.style.height="8%",document.body.style.height=e||i?window.innerHeight+50+"px":window.innerHeight+"px",Math.floor(c)>window.innerWidth&&(t=l/u,c=window.innerWidth,h=c*t,o.style.height=window.innerHeight-h+"px",o.style.position="fixed"),s.style.width=c+"px",s.style.height=h+"px",r.style.width=c+"px",r.style.height=h+"px",r.style.marginLeft="-"+c/2+"px",window.setTimeout(function(){window.scrollTo(0,1)},1),w(!0)}function m(t,e,i){let n,r=t.layers,s=t;for(n=0;n<=r.length;n++)t=r[n],n===r.length&&(t=s),t.draw&&(t.frameRate<=0||t.currentFrame>=t.frames)?(a.save(),a.globalAlpha=t.alpha,a.drawImage(t.image,t.width*(t.frames-1),0,t.width,t.height,e,i,t.width,t.height),a.restore()):t.draw&&(a.save(),a.globalAlpha=t.alpha,a.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,e,i,t.width,t.height),a.restore())}s.width=u,s.height=l,window.addEventListener("load",g,!1),window.addEventListener("resize",function(t,e,i){let n;return function(){let r=this,s=arguments,o=i&&!n;clearTimeout(n),n=window.setTimeout(function(){n=null,i||t.apply(r,s)},e),o&&t.apply(r,s)}}(g,250,!1),!1);let y=function(){let t=0,e=d.spr_tiledGrass();return function(){m(e,0,t-l),m(e,0,t),f.accelerating()&&!f.gameOver()&&(t=(t+20)%l)}}(),w=function(){const t=d.spr_collar(),e=document.getElementById("score");let i=0,s=0;return function(o=!1){let a,h,c;if(f&&!f.started())r.style.display="block";else if(f&&(r.style.display="none",a=f.player().life,h=f.score(),(s!==h||o)&&(s=h,e.textContent="Score: "+h),i!==a||o)){for(i=a,c=0;c<n.childNodes.length;c++)n.childNodes[c]instanceof Image&&(n.removeChild(n.childNodes[c]),c--);for(c=0;c<a;c++){let e=document.createElement("img");e.src=t.image.src,e.className="life",n.appendChild(e)}}}}();return{render:function(t){let e,i,n=f.entities(),r=n.length;for(y(),w(),i=0;i<r;i++)(e=n[i]).sprite&&((f.accelerating()||e instanceof o||0!==e.sprite.fadeAmt)&&e.sprite.update(t),e.sprite.foreground?p.push(e):m(e.sprite,e instanceof o?e.x+e.width/4:e.x,e.y));for(i=0;i<p.length;i++)m((e=p[i]).sprite,e.x,e.y);p.length=0},canvas:s,isIOS:function(){return i},currentWidth:function(){return c}}}(),f=function(){const n=Object.freeze({single:1,clones:2,graves:3});let r,c,f,g,m,y,w,v,b,k,x,E,L,_,A,F,M=new i(new o(0,0,0,0,null)),I=new i(new h(0,0,0,0,null)),S=l-l/5,T=l/4,P=l-l/3,R=!1,B=n.graves,N=1,O=function(){const t=6;let e,i=[];for(e=0;e<t;e++)i.push(u*(e/t));return{NUM_LANES:t,getLaneByLocation:function(n){for(e=t;e>=0;e--)if(n>i[e])return e;return-1},getCenterX:function(t){return i[t]}}}(),D=function(){let e,i,r,o,a,h,c,p,f,g,m;let y=function(){let n,s,c,u,p=!1;switch(console.log(o),o){case 4:f.x=0,f.y=i-T+20,f.sprite.alpha=0,f.sprite.fadeAmt=.04;break;case 18:case 78:g.x=0,g.y=i-T+130,g.sprite.alpha=0,g.sprite.fadeAmt=.04;break;case 33:case 118:m.x=0,m.y=i-T+130,m.sprite.alpha=0,m.sprite.fadeAmt=.04;break;case 58:g.sprite.fadeAmt=-.04,m.sprite.fadeAmt=-.04}switch(a){case 0:case 1:case 2:p=!0;break;case 5:case 6:case 7:e=1,i=.75*l,p=!0;break;case 20:i=l/2;break;case 35:i=l/3;break;case 60:e=2,i=.75*l;break;case 80:i=l/2;break;case 130:i=l/3;break;case 200:e=3,i=.75*l;break;case 220:i=l/2;break;case 330:i=l/3;break;default:a>350&&(i=l/5)}for(c=t(O.NUM_LANES-e),u=0;u<=e;u++)(n=I.take()).lane=c+u,n.x=O.getCenterX(c+u),n.y=-10,n.speed=20,n.invisPointY=i,n.sprite=d.spr_grave(),n.width=n.sprite.width,n.height=n.sprite.width,n.isFake=!0,r[u]=n,Y(n);s=r[t(r.length)],d.putSpriteBack(s.sprite),s.sprite=d.spr_enemy(),s.sprite.addLayer(d.spr_grave()),s.isFake=!1,s.sprite.draw=!0,p&&h.push({lane:s.lane,wave:a}),a++},w=function(){let e,n,r=!1;switch(a){case 0:case 1:case 2:r=!0;break;case 5:case 6:case 7:i=.75*l,r=!0;break;case 20:i=l/2;break;case 35:i=l/3;break;case 80:i=.75*l;break;case 100:i=l/2;break;case 140:i=l/3;break;case 220:i=.75*l;break;case 240:i=l/2;break;case 350:i=l/3;break;default:a>350&&(i=l/5)}n=t(O.NUM_LANES),(e=I.take()).lane=n,e.x=O.getCenterX(n),e.y=-10,e.speed=20,e.invisPointY=i,e.sprite=d.spr_enemy(),e.width=e.sprite.width,e.height=e.sprite.height,e.isFake=!1,Y(e),r&&h.push({lane:n,wave:a}),a++},v=function(){let n,s,o,c,u=!1;switch(a){case 0:case 1:case 2:u=!0;break;case 5:case 6:case 7:e=1,i=.75*l,u=!0;break;case 20:i=l/2;break;case 35:i=l/3;break;case 80:e=2,i=.75*l;break;case 100:i=l/2;break;case 140:i=l/3;break;case 220:e=3,i=.75*l;break;case 240:i=l/2;break;case 350:i=l/3;break;default:a>350&&(i=l/5)}for(o=t(O.NUM_LANES-e),c=0;c<=e;c++)(n=I.take()).lane=o+c,n.x=O.getCenterX(o+c),n.y=-10,n.speed=20,n.invisPointY=i,n.sprite=d.spr_enemy(),n.width=n.sprite.width,n.height=n.sprite.height,n.sprite.draw=!1,n.isFake=!0,r[c]=n,Y(n);(s=r[t(r.length)]).isFake=!1,s.sprite.draw=!0,u&&h.push({lane:s.lane,wave:a}),a++};return{init:function(){switch(e=0,r=[],o=0,a=0,h=[],c=0,f=new s(-u,-l,0,0,d.spr_fog()),g=new s(-u,-l,0,0,d.spr_fog()),m=new s(-u,-l,0,0,d.spr_fog()),f.sprite.foreground=!0,g.sprite.foreground=!0,m.sprite.foreground=!0,Y(f),Y(g),Y(m),i=2*l,B){case n.single:p=w;break;case n.clones:p=v;break;case n.graves:p=y}},updateWavesPassed:function(){o++},showTutorial:function(){if(c<h.length&&h[c].wave===o){let t;(t=M.take()).x=O.getCenterX(h[c++].lane),t.y=S,t.sprite=d.spr_tapIcon(),t.width=t.sprite.width,t.height=t.sprite.height,Y(t)}},spawn:function(){p()},wavesPassed:function(){return o}}}();function C(){v=!v}function W(){w=!w}function Y(t){t instanceof a?m=t:t instanceof h&&f.push(t),r.push(t)}function H(t){let i,n=t.length;if(0!==n){for(i=n-1;i>=0;i--){let n,s=t[i];null!==s.sprite&&d.putSpriteBack(s.sprite),(n=r.indexOf(s))>=0&&e(r,n),(n=f.indexOf(s))>=0&&(e(f,n),I.putBack(s)),s instanceof o&&M.putBack(s)}t.includes(m)&&(m=void 0)}}function X(){k=!k}let j=function(){const t=1500;let e,i=!1,n=0,r=3;function s(){N=1,n=0,r=3,i=!1,console.log("Multiplier reset to 1.")}return{start:function(){i=!0,e=window.setTimeout(s,t)},stop:function(){i&&(window.clearTimeout(e),i=!1,1==(n=(n+1)%r)&&(r+=2,N+=.5,console.log(N+"x multipler!")))},reset:s}}();return{start:function(){if(r&&H(r),r=[],f=[],g=[],c=[],x=!1,w=!0,v=!1,b=!1,k=!1,_=0,A=0,y=0,D.init(),"undefined"!=typeof Storage){try{F=JSON.parse(localStorage.getItem("nback_scores"))}catch(t){F=[]}null===F&&(F=[])}Y(m=new a(-100,-100,null)),D.spawn(),R||(R=!0,E=this.update.bind(this),L&&window.cancelAnimationFrame(L),window.requestAnimationFrame(E))},update:function(t){let e,i,s,a=!1,u=r.length,d=Math.min((t-y)/1e3,.05);if(y=t,x)return p.render(d),R=!1,void(L=window.requestAnimationFrame(E));for(s=0;s<u;s++){if(i=(e=r[s]).invisPointY-T,w&&e.update(d),e instanceof h&&e.y>=P&&!e.clicked&&g.indexOf(e)<0&&g.push(e),e.y>l)c.push(e),e instanceof h&&!e.isFake&&v&&C();else if(e instanceof h&&(B===n.clones&&e.isFake||B===n.single||B===n.graves&&!e.isFake)&&e.y>=i&&e.y<e.invisPointY)B===n.graves?e.sprite.alpha=1-(e.y-i)/(e.invisPointY-i):e.sprite.draw=!e.sprite.draw;else if(e instanceof h&&(B===n.clones&&e.isFake||B===n.single||B===n.graves&&!e.isFake)&&e.y>=e.invisPointY&&!e.clicked)switch(B){case n.single:case n.graves:e.sprite.draw=!1;break;case n.clones:e.sprite.draw=!0}e instanceof h&&!e.isFake&&e.y>=T&&!e.triggeredWave&&(D.spawn(),e.triggeredWave=!0),w&&!v&&e instanceof h&&e.y>=S&&!e.triggeredPause&&(a=!0,e.triggeredPause=!0),b&&e instanceof o&&c.push(e)}a&&(W(),C(),D.showTutorial(),X(),j.start()),b&&(b=!1),H(c),c.length=0,p.render(d),window.requestAnimationFrame(E)},setGameOver:function(){var t;x||(x=!0,t=Math.round(_),F.push(t),F.sort(function(t,e){return e-t}),F=F.slice(0,10),"undefined"!=typeof Storage&&localStorage.setItem("nback_scores",JSON.stringify(F)))},addScore:function(t){(A=(_+=t*N+A)%1)>0&&(_-=A)},toggleAcceleration:W,toggleInputBuffer:C,setInputEventFired:function(){b=!0},lanes:O,addEntity:Y,clickZone:P,updateWavesPassed:D.updateWavesPassed,toggleInput:X,inputTimer:j,spawnMode:B,easyAccuracy:!1,stoppingThreshold:S,inputEnabled:function(){return k},accelerating:function(){return w},inputBuffered:function(){return v},started:function(){return R},gameOver:function(){return x},entities:function(){return r},enemies:function(){return f},player:function(){return m},frontRowEnemies:function(){return g},score:function(){return _}}}(),g=32,m=new n(-1*g,-1*g,g,g+10),y=null,w=null;function v(t){if(!f.started())return;let e,i,n,r,s=f.clickZone,o=null,a=f.frontRowEnemies(),h=f.player(),c=a.length,l=0,u=0;if("touchstart"===t.type?e=b(t.changedTouches[0]):"mousedown"===t.type&&(e=b(t)),!f.gameOver()&&h&&f.inputEnabled()&&e.y>=s){for(m.x=e.x-g/2,m.y=e.y-g/2,f.easyAccuracy&&(m.x=f.lanes.getCenterX(f.lanes.getLaneByLocation(e.x)),m.y=f.stoppingThreshold,m.height=64,m.width=1),n=0;n<c;n++)(l=(r=(i=a[n]).collisionRect()).intersection(m).getArea())>u&&(u=l,i.clicked=!0,o=i);u>0&&(f.toggleInput(),d.putSpriteBack(o.sprite),o.isFake?(o.sprite=d.spr_bigX(),h.loseLife(),f.inputTimer.reset(),d.snd_error.play()):(o.sprite=d.spr_check(),h.addLife(),f.inputTimer.stop(),d.snd_valid.play()),f.setInputEventFired(),f.accelerating()?f.inputBuffered()||f.toggleInputBuffer():f.toggleAcceleration(),a.length=0,f.updateWavesPassed())}}function b(t){let e=p.currentWidth()/u;return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(p.canvas))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(p.canvas))/e}}function k(t,e){let i=e.value;i=Number(i),p.isIOS()&&(i<=0?(i=1,e.value="1"):(i=0,e.value="0")),t.innerHTML=i<=0?"volume_mute":"volume_up",d.setMasterVolume(i)}p.canvas.addEventListener("touchstart",function(t){"mousedown"===y?Date.now()-w>1e3&&(y=t.type,w=Date.now(),v(t)):(y=t.type,w=Date.now(),v(t))}),p.canvas.addEventListener("mousedown",function(t){"touchstart"===y?Date.now()-w>1e3&&(y=t.type,w=Date.now(),v(t)):(y=t.type,w=Date.now(),v(t))});let x=document.querySelector("#overlay-volume~.slider"),E=document.querySelector("#widebar-volume~.slider"),L=document.querySelector("#overlay-volume+label>i"),_=document.querySelector("#widebar-volume+label>i");document.getElementById("overlay-volume").checked=!1,document.getElementById("widebar-volume").checked=!1,x.addEventListener("mouseup",function(t){k(L,x)}),E.addEventListener("mouseup",function(t){k(_,E)}),p.isIOS()?(x.style.visibility="hidden",E.style.visibility="hidden",L.addEventListener("touchend",function(t){t.preventDefault(),k(L,x)}),_.addEventListener("touchend",function(t){t.preventDefault(),k(_,E)})):(x.addEventListener("touchend",function(t){t.preventDefault(),k(L,x)}),E.addEventListener("touchend",function(t){t.preventDefault(),k(_,E)})),document.getElementById("start_button").addEventListener("click",function(){d.snd_bgm.play(),f.start()}),document.body.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),window.addEventListener("load",function(){let t=d.initVolume();0===t?(L.innerHTML="volume_mute",_.innerHTML="volume_mute"):t&&(L.innerHTML="volume_up",_.innerHTML="volume_up"),document.getElementById("container").style.display="block"},!1)}();