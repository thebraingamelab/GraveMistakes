let gameAccessor=function(){"use strict";let t={canvasId:"game-canvas",wrapperId:"canvas-wrapper",containerId:"game-container",resizeDelay:250,canvasPosition:"bottom center",stretchToFit:!1,scaleByDPR:!1,orientation:"portrait",gameFieldWidth:540,gameFieldHeight:960},e=function(){if(!t)return console.log("ERROR: unable to load config.js"),null;let e,i,n,o,s,a,r,l,h,c,d,u,p,f,m,g=!1,y=[],v=0;function w(){const g=window.devicePixelRatio||1;let w,E;for(c&&(s=parseFloat(window.getComputedStyle(h).getPropertyValue("padding-left")),a=parseFloat(window.getComputedStyle(h).getPropertyValue("padding-right")),r=parseFloat(window.getComputedStyle(h).getPropertyValue("padding-top")),l=parseFloat(window.getComputedStyle(h).getPropertyValue("padding-bottom")),n=h.clientHeight-(r+l),o=h.clientWidth-(s+a),m="both"===t.orientation?window.innerWidth>=window.innerHeight?"landscape":"portrait":t.orientation,t.stretchToFit?(u=n,p=o):"portrait"===m?(f="fitWidth",w=t.gameFieldWidth/t.gameFieldHeight,p=(u=n)*w,Math.floor(p)>o&&(f="fitHeight",w=t.gameFieldHeight/t.gameFieldWidth,u=(p=o)*w)):(f="fitHeight",w=t.gameFieldHeight/t.gameFieldWidth,u=(p=o)*w,Math.floor(u)>n&&(f="fitWidth",w=t.gameFieldWidth/t.gameFieldHeight,p=(u=n)*w)),t.scaleByDPR&&(c.width=Math.round(t.gameFieldWidth*g),c.height=Math.round(t.gameFieldHeight*g),i.scale(g,g)),d.style.width=Math.round(p)+"px",d.style.height=Math.round(u)+"px",function(){let e,i,c,f,m=t.canvasPosition.split(" ");"absolute"===window.getComputedStyle(h).getPropertyValue("position")?(e=document.body.getBoundingClientRect(),i=h.getBoundingClientRect(),c=i.left-e.left,f=i.top-e.top):(c=0,f=0);switch(m[0]){default:case"center":d.style.top=Math.round(f+r+(n/2-u/2))+"px";break;case"top":d.style.top=Math.round(f+r)+"px";break;case"bottom":d.style.top=Math.round(f+h.clientHeight-u-l)+"px"}switch(m[1]){default:case"center":d.style.left=Math.round(c+s+(o/2-p/2))+"px";break;case"left":d.style.left=Math.round(c+s)+"px";break;case"right":d.style.left=Math.round(c+h.clientWidth-p-a)+"px"}}(),e=c.getBoundingClientRect()),E=0;E<v;E++)y[E]()}return{init:function(){g?console.log("ERROR: resizer already initialized."):(g=!0,h=document.getElementById(t.containerId),""!==t.canvasId&&(c=document.getElementById(t.canvasId),i=c.getContext("2d"),p=t.gameFieldWidth,u=t.gameFieldHeight,c.width=p,c.height=u,""!==t.wrapperId?(d=document.getElementById(t.wrapperId),c.style.width="100%",c.style.height="100%"):d=c,d.style.position="absolute"),t.resizeDelay>0?window.addEventListener("resize",function(t,e,i){let n;return function(){let o=this,s=arguments,a=i&&!n;clearTimeout(n),n=window.setTimeout(function(){n=null,i||t.apply(o,s)},e),a&&t.apply(o,s)}}(w,t.resizeDelay,!1),!1):window.addEventListener("resize",w,!1),w())},resize:w,getOrientation:function(){return m},getSizeMode:function(){return f},getCanvas:function(){return c||(console.log("ERROR: canvas has been set to false in config.js"),null)},getContainer:function(){return h},getGameHeight:function(){return t.gameFieldHeight},getGameWidth:function(){return t.gameFieldWidth},getCanvasWidth:function(){return p},getCanvasHeight:function(){return u},getCanvasBoundingRect:function(){return e},addResizeEvent:function(t){y.push(t),v++},removeResizeEvent:function(t){let e=0;for(;y[e]!==t&&e<v;)e++;e<v&&(y[e]=y[y.length-1],y[y.length-1]=void 0,y.length=y.length-1)},getRelativeEventCoords:function(e){let i=p/t.gameFieldWidth;return{x:(e.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(c))/i,y:(e.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(c))/i}}}}();e.init();const i=e.getGameHeight(),n=e.getGameWidth();let o,s,a,r=32,l=new j(-1*r,-1*r,r,r+10),h=null,c=null,d=document.getElementById("tap-to-start"),u=document.getElementById("top-bar"),p=document.getElementById("pause-box"),f=document.getElementById("help-box"),m=document.getElementById("pause"),g=document.getElementById("help"),y=document.getElementById("pause-menu"),v=document.getElementById("resume"),w=document.getElementById("restart"),E=document.getElementById("exit"),b=(document.getElementById("music-mini"),document.getElementById("volume-mini")),k=document.getElementById("help-mini"),x=document.getElementById("help-menu"),L=document.getElementById("help-back"),I=document.getElementById("report-a-bug"),R=document.getElementById("tutorial"),F=document.getElementById("not-implemented-menu"),A=document.getElementById("not-implemented-back"),B=document.getElementById("confirmation-menu"),C=document.getElementById("confirmation-yes"),P=document.getElementById("confirmation-back"),S=null,T=document.getElementById("dimmer"),M=function(){let t=!1;return function(){T.classList.remove("partial-fade-out"),T.classList.add("partial-fade-in"),T.style.display="block",u.style.visibility="hidden",o=window.setInterval(function(){"none"===d.style.display?d.style.display="":d.style.display="none",t||(t=!0,e.getCanvas().addEventListener("click",function i(){window.clearInterval(o),d.style.display="none",u.style.visibility="visible",T.classList.remove("partial-fade-in"),T.classList.add("partial-fade-out"),T.addEventListener("animationend",function t(){T.style.display="none",T.removeEventListener("animationend",t)},!1),t=!1,$.start(),e.getCanvas().removeEventListener("click",i)},!1))},500)}}();function _(){window.location.assign("https://thebraingamelab.org/")}let D=function(){let t=!1,e=b.firstElementChild.firstElementChild;return function(){(t=!t)?(e.setAttribute("href","#no-volume-icon"),K.mute()):(e.setAttribute("href","#volume-icon"),K.unmute())}}();function W(){H(x,F)}function N(t){t.style.display="block",t.classList.remove("center-popin"),t.classList.add("center-popout"),T.classList.remove("partial-fade-out"),T.classList.add("partial-fade-in"),T.style.display="block",u.style.display="none"}function O(t){t.classList.remove("center-popout"),t.classList.add("center-popin"),t.addEventListener("animationend",function e(){t.style.display="none",t.removeEventListener("animationend",e)},!1),T.classList.remove("partial-fade-in"),T.classList.add("partial-fade-out"),T.addEventListener("animationend",function t(){T.style.display="none",T.removeEventListener("animationend",t)},!1),u.style.display="block"}function H(t,e){t.classList.remove("center-popout"),t.classList.add("center-popin"),t.addEventListener("animationend",function e(){t.style.display="none",t.removeEventListener("animationend",e)},!1),t.addEventListener("animationend",function i(){e.style.display="block",e.classList.remove("center-popin"),e.classList.add("center-popout"),t.removeEventListener("animationend",i)},!1)}function G(t){return Math.floor(Math.random()*Math.floor(t))}function z(t,e){e>=t.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):t.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(t[e]=t[t.length-1],t.pop())}function Y(t){this.template=t,this.pool=[]}function j(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function V(t,e,i,n,o){this.width=e,this.height=i,this.frames=n,this.frameRate=o,this.timer=0,this.currentFrame=0,this.image=t,this.animationEndEvent=null,this.layers=[],this.draw=!0,this.foreground=!1,this.alpha=1,this.fadeAmt=0}function X(t,e,i,n,o){this.x=t,this.y=e,this.xFraction=0,this.yFraction=0,this.time=0,this.width=i,this.height=n,this.sprite=o,this.hitbox=new j(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}function U(t,e,i,n,o){X.call(this,t,e,i,n,o)}function Z(t,e,i){let n=0,o=0;i&&(n=i.width,o=i.height),X.call(this,t,e,n,o,i),this.maxLife=3,this.life=this.maxLife}function q(t,e,i,n,o){let s=0,a=0;o&&(s=o.width,a=o.height),X.call(this,t,e,s,a,o),this.invisPointY=n,this.speed=i,this.isFake=!1,this.lane=1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1,this.column=0}function J(t,e,i,n=!1){let o,s,a=this;if(this.buffer=null,this.audioContext=e,this.gainNode=i,this.loop=n,(o=document.createElement("audio")).canPlayType)if(o.canPlayType&&""!==o.canPlayType("audio/mp4"))t+=".mp4";else{if(!o.canPlayType||""===o.canPlayType('audio/ogg; codecs="vorbis"'))return void console.log("Error: MP4 and OGG files are unsupported on this device.");t+=".ogg"}(s=new XMLHttpRequest).open("GET",encodeURI(t),!0),s.responseType="arraybuffer",s.addEventListener("error",function(){console.log("Error loading from server: "+t)},!1),s.addEventListener("load",function(){e.decodeAudioData(s.response,function(t){a.buffer=t},function(t){console.log("Error decoding audio data: "+t.err)})},!1),s.send()}Y.prototype.take=function(){let t,e,i=this.pool.length,n=null;for(e=0;e<i;e++)if((n=this.pool[e]).available)return n.available=!1,n.object.init(),n.object;return(t=this.template.clone()).init(),this.pool.push({available:!1,object:t}),t},Y.prototype.putBack=function(t){let e,i,n=this.pool.length;for(i=0;i<n;i++)if((e=this.pool[i]).object===t)return void(e.available=!0)},j.prototype.left=function(){return this.x},j.prototype.right=function(){return this.x+this.width},j.prototype.top=function(){return this.y},j.prototype.bottom=function(){return this.y+this.height},j.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},j.prototype.contains=function(t,e){return this.left()<=t&&t<=this.right()&&this.bottom()<=e&&e<=this.top()},j.prototype.union=function(t){let e,i,n,o;if(void 0!==t)return e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=i,this.width=n,this.height=o,this},j.prototype.intersection=function(t){let e,i,n,o;return e=Math.max(this.left(),t.left()),o=Math.min(this.bottom(),t.bottom()),i=Math.min(this.right(),t.right()),n=Math.max(this.top(),t.top()),e>i||o<n?(this.x=-1,this.y=-1,this.width=0,this.height=0):(this.x=e,this.y=n,this.width=i-e,this.height=o-n),this},j.prototype.getArea=function(){return this.height*this.width},V.prototype.eventDriven=function(t,e,i,n,o,s,a,r,l,h){let c=document.createElement("img"),d=document.createElement("img");return c.addEventListener("load",function t(){let a=document.createElement("canvas"),h=a.getContext("2d");a.width=e*s,a.height=i,h.drawImage(c,l*n,r*o,n*s,o,0,0,e*s,i),d.src=a.toDataURL("image/png"),c.removeEventListener("load",t)},!1),c.src=t,this.width=e,this.height=i,this.frames=s,this.frameRate=a,this.image=d,this},V.prototype.tiled=function(t,e,i,n,o,s,a,r,l){let h=document.createElement("img"),c=document.createElement("img");return h.addEventListener("load",function t(){let d,u,p=document.createElement("canvas"),f=p.getContext("2d");for(p.width=e,p.height=i,d=0;d<r;d++)for(u=0;u<l;u++)f.drawImage(h,a*n,s*o,n,o,d*e/r,u*i/l,e/r,i/l);c.src=p.toDataURL("image/png"),h.removeEventListener("load",t)},!1),h.src=t,this.width=e,this.height=i,this.frameRate=0,this.frames=1,this.image=c,this},V.prototype.resetAnimation=function(){this.currentFrame=0},V.prototype.update=function(t){let e;var i,n,o;for(this.alpha=(i=this.alpha+this.fadeAmt,n=0,o=1,Math.min(Math.max(i,n),o)),e=0;e<this.layers.length;e++)this.layers[e].update(t);this.frameRate>0&&(this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame++,this.currentFrame>this.frames-1&&null!==this.animationEndEvent&&this.animationEndEvent()))},V.prototype.init=function(){this.width=0,this.height=0,this.frameRate=0,this.frames=0,this.currentFrame=0,this.timer=0,this.alpha=1,this.fadeAmt=0,this.layers.length=0,this.image=null,this.animationEndEvent=null,this.draw=!0,this.foreground=!1},V.prototype.clone=function(){return new V(this.image,this.width,this.height,this.frames,this.frameRate)},V.prototype.copyAttributes=function(t){return this.width=t.width,this.height=t.height,this.frameRate=t.frameRate,this.frames=t.frames,this.image=t.image,this.animationEndEvent=t.animationEndEvent,this.draw=t.draw,this.alpha=t.alpha,this.fadeAmt=t.fadeAmt,this.foreground=t.foreground,this},V.prototype.addLayer=function(t){this.layers.push(t)},X.prototype.init=function(){this.x=0,this.y=0,this.xFraction=0,this.yFraction=0,this.time=0,this.sprite=null},X.prototype.clone=function(){return new X(this.x,this.y,this.width,this.height,this.sprite)},X.prototype.update=function(t){let e=this.x,i=this.y,n=this.xFraction,o=this.yFraction;this.time+=t,e+=n,i+=o,e-=n=e%1,i-=o=i%1,this.x=e,this.y=i,this.xFraction=n,this.yFraction=o},X.prototype.collisionRect=function(){return this.hitbox.x=this.x,this.hitbox.y=this.y,this.hitbox.width=this.width,this.hitbox.height=this.height,this.hitbox},X.prototype.isCollidingWith=function(t){let e=this.collisionRect(),i=t.collisionRect();return e.intersects(i)},U.prototype=Object.create(X.prototype),U.prototype.init=function(){X.prototype.init.call(this)},U.prototype.clone=function(){return new U(this.x,this.y,this.width,this.height,this.sprite)},Z.prototype=Object.create(X.prototype),Z.prototype.update=function(t){X.prototype.update.call(this,t),$.addScore(1)},Z.prototype.addLife=function(){this.life+=1,this.life>=this.maxLife&&(this.life=this.maxLife)},Z.prototype.loseLife=function(){this.life-=1,this.life<=0&&$.setGameOver()},Z.prototype.move=function(t,e){this.x=t,this.y=e},q.prototype=Object.create(X.prototype),q.prototype.init=function(){X.prototype.init.call(this),this.x=-100,this.y=-100,this.invisPointY=0,this.speed=0,this.lane=1,this.isFake=!1,this.triggeredWave=!1,this.triggeredPause=!1,this.clicked=!1,this.column=0},q.prototype.clone=function(){return new q(this.x,this.y,this.speed,this.invisPointY,this.sprite)},q.prototype.update=function(t){X.prototype.update.call(this,t),this.y+=this.speed},J.prototype.play=function(){let t=this;if(this.buffer){let t=this.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gainNode).connect(this.audioContext.destination),t.start(0),t.loop=this.loop}else window.setTimeout(function(){t.play()},50)};let K=function(){let t,e,o,s,a,r,l,h=new Y(new V(null,0,0,0,0)),c=h.take().eventDriven("build/sprites/ghost.png",72,72,128,128,1,0,0,0),d=h.take().tiled("build/sprites/grassland-tile.jpg",n,i,414,307,0,0,1,2),u=h.take().eventDriven("build/sprites/bigx.png",90,90,128,128,1,0,0,0),p=h.take().eventDriven("build/sprites/check.png",90,90,128,128,1,0,0,0),f={original:h.take().eventDriven("build/sprites/grave.png",90,90,128,128,1,0,0,0)},m=h.take().eventDriven("build/sprites/fog.png",n,180,438,266,1,0,0,0),g=h.take().eventDriven("build/sprites/tap.png",90,90,64,64,2,3,0,0);function y(t){if(s=t,o.gain.value=r*t,e.gain.value=a*t,"undefined"!=typeof Storage)try{localStorage.setItem("nback_masterVolume",JSON.stringify(s))}catch(t){console.log("Error: an issue occurred when saving volume data.")}}return g.animationEndEvent=g.resetAnimation,t=new(window.AudioContext||window.webkitAudioContext),s=1,a=.1,r=.15,(e=t.createGain()).gain.value=a,(o=t.createGain()).gain.value=r,{spr_enemy:function(){return h.take().copyAttributes(c)},spr_tapIcon:function(){return h.take().copyAttributes(g)},spr_tiledGrass:function(){return h.take().copyAttributes(d)},spr_bigX:function(){return h.take().copyAttributes(u)},spr_check:function(){return h.take().copyAttributes(p)},spr_fog:function(){return h.take().copyAttributes(m)},spr_grave:function(t){return t=t||"original",h.take().copyAttributes(f[t])},snd_valid:new J("audio/ding",t,o),snd_error:new J("audio/error",t,o),snd_bgm:new J("audio/bgm",t,e,!0),initVolume:function(){let t;if("undefined"!=typeof Storage){try{t=JSON.parse(localStorage.getItem("nback_masterVolume"))}catch(t){console.log("Previous volume data is corrupted or missing.")}if(t||0===t)return s=t,this.setMasterVolume(t),t}return null},setMasterVolume:y,mute:function(){l=s,y(0)},unmute:function(){y(l)},putSpriteBack:function(t){let e;for(e=t.layers.length;e>=0;e--)h.putBack(t.layers[e]);h.putBack(t)},STANDARD_SIZE:90,GHOST_SIZE:72}}(),Q=function(){const t=document.getElementById("bar-label"),n=document.getElementById("lives");let o=e.getCanvas(),s=o.getContext("2d",{alpha:!1}),a=0,r=0,l=[];function h(t,e,i){let n,o=t.layers,a=t;for(n=0;n<=o.length;n++)t=o[n],n===o.length&&(t=a),t.draw&&(t.frameRate<=0||t.currentFrame>=t.frames)?(s.save(),s.globalAlpha=t.alpha,s.drawImage(t.image,t.width*(t.frames-1),0,t.width,t.height,e,i,t.width,t.height),s.restore()):t.draw&&(s.save(),s.globalAlpha=t.alpha,s.drawImage(t.image,t.width*t.currentFrame,0,t.width,t.height,e,i,t.width,t.height),s.restore())}let c=function(){let t=0,e=K.spr_tiledGrass();return function(){h(e,0,t-i),h(e,0,t),$.accelerating()&&!$.gameOver()&&(t=(t+20)%i)}}();return{render:function(e){let i,o,s,d=$.entities();if(c(),d){for(s=d.length,function(e=!1){let i,o,s,l,h;if($&&!$.started());else if($&&(i=$.player().life,o=$.score(),(r!==o||e)&&(r=o,t.textContent="Score: "+o),a!==i||e)){for(a=i,h=0;h<n.childNodes.length;h++)n.removeChild(n.childNodes[h]),h--;for(h=0;h<i;h++)s=document.createElementNS("http://www.w3.org/2000/svg","svg"),(l=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttribute("href","#heart"),s.appendChild(l),n.appendChild(s)}}(),o=0;o<s;o++)(i=d[o]).sprite&&(($.accelerating()||i instanceof U||0!==i.sprite.fadeAmt)&&i.sprite.update(e),i.sprite.foreground?l.push(i):h(i.sprite,i instanceof U?i.x+i.width/4:i.x,i.y));for(o=0;o<l.length;o++)h((i=l[o]).sprite,i.x,i.y);l.length=0}},canvas:o}}(),$=function(){const t=1e3;let e,o,s,r,l,h=new Y(new U(0,0,0,0,null)),c=new Y(new q(0,0,0,0,null)),u=20,p=-K.STANDARD_SIZE;const f=20*Math.round(i/10/20+1)-(p%20+20);let m,g=i-i/5;g-=g%u;let y,v,w,E,b,k,x,L,I,R,F=i-i/3,A=!1,B=1,C=function(){const t=6;let e,i=[];for(e=0;e<t;e++)i.push(n*(e/t));return{NUM_LANES:t,getLaneByLocation:function(n){for(e=t;e>=0;e--)if(n>i[e])return e;return-1},getCenterX:function(t){return i[t]}}}(),P=function(){let t,e,n,o,s,a,r,l;const d=.04;let f,y,v,w;function E(t){let e,i,n,s;for(;f.length>t;)(e=f.pop()).sprite.fadeAmt=-d,y.putBack(e),D([e]);for(n=f.length;f.length<t;){for((e=y.take()).sprite=K.spr_fog(),e.sprite.alpha=0,e.sprite.fadeAmt=d,e.sprite.foreground=!0,e.x=0,e.y=g,s=0;s<=n;s++)i=m[o+n]-p,e.y-=i;e.y-=K.STANDARD_SIZE/2,f.push(e),_(e),n++}}function b(){let i,n,a,r;if(v.length&&v.length>0){for(n=v.pop(),(i=fogLevels[o])&&E(i),enemyLane=G(C.NUM_LANES-t),a=0;a<n.length;a++)enemy=c.take(),enemy.isFake=!!n[a],w&&w[s]&&(r=w[s][a]),enemy.isFake?enemy.sprite=K.spr_grave(r):(enemy.sprite=K.spr_enemy(),enemy.sprite.addLayer(K.spr_grave()),enemy.draw=!0),enemy.lane=enemyLane+a,enemy.x=C.getCenterX(a),enemy.y=-10,enemy.speed=u,enemy.invisPointY=e,enemy.width=enemy.sprite.width,enemy.height=enemy.sprite.width,enemy.column=a,_(enemy);s++}else console.log("No more waves!")}function k(){let i,a,l,h,d=!1;switch(o){case 4:E(1);break;case 18:case 78:E(2);break;case 33:case 118:E(3);break;case 58:E(1)}switch(s){case 0:case 1:case 2:d=!0;break;case 5:case 6:case 7:t=1,e=g-(m[s]-p),d=!0;break;case 20:e=g-2*(m[s]-p);break;case 35:e=g-3*(m[s]-p);break;case 60:t=2,e=g-(m[s]-p);break;case 80:e=g-2*(m[s]-p);break;case 130:e=g-3*(m[s]-p);break;case 200:t=3,e=g-(m[s]-p);break;case 220:e=g-2*(m[s]-p);break;case 330:e=g-3*(m[s]-p);break;default:s>350&&(e=g-4*(m[s]-p))}for(l=G(C.NUM_LANES-t),h=0;h<=t;h++)(i=c.take()).lane=l+h,i.x=C.getCenterX(l+h),i.y=p,i.speed=u,i.invisPointY=e,i.sprite=K.spr_grave(),i.width=i.sprite.width,i.height=i.sprite.width,i.isFake=!0,i.column=h,n[h]=i,_(i);a=n[G(n.length)],K.putSpriteBack(a.sprite),a.sprite=K.spr_enemy(),a.sprite.addLayer(K.spr_grave()),a.isFake=!1,a.sprite.draw=!0,d&&r.push({lane:a.lane,wave:s}),s++}return{init:function(h){(h=h||{}).map?(v=h.map,fogLevels=h.fogLevels,a=b):a=k,w=h.graveShapes,t=0,n=[],o=0,s=0,r=[],l=0,y=new Y(new X(0,0,0,0,null)),f=[],e=2*i},updateWavesPassed:function(){o++},showTutorial:function(){if(l<r.length&&r[l].wave===o){let t;(t=h.take()).x=C.getCenterX(r[l++].lane),t.y=g,t.sprite=K.spr_tapIcon(),t.sprite.foreground=!0,t.width=t.sprite.width,t.height=t.sprite.height,_(t)}},spawn:function(){a()},wavesPassed:function(){return o}}}();function S(){w=!w}function T(){v=!v}function _(t){t instanceof Z?l=t:t instanceof q&&s.push(t),e.push(t)}function D(t){let i,n=t.length;if(0!==n){for(i=n-1;i>=0;i--){let n,o=t[i];null!==o.sprite&&K.putSpriteBack(o.sprite),(n=e.indexOf(o))>=0&&z(e,n),(n=s.indexOf(o))>=0&&(z(s,n),c.putBack(o)),o instanceof U&&h.putBack(o)}t.includes(l)&&(l=void 0)}}function W(){b=!b}let N=function(){const t=1500;let e,i,n=!1,o=0,s=3;function r(t=!1){B=1,o=0,s=3,n=!1,t&&a.timeToPick.push(Date.now()-i)}return{start:function(){n=!0,e=window.setTimeout(r,t),i=Date.now()},stop:function(){n&&(window.clearTimeout(e),n=!1,1==(o=(o+1)%s)&&(s+=2,B+=.5)),a.timeToPick.push(Date.now()-i)},reset:r}}();return{start:function(i){let n,h,c;if(e&&D(e),e=[],s=[],r=[],o=[],k=!1,v=!0,w=!1,E=!1,b=!1,I=0,R=0,y=0,a={selections:[],inputType:"none",timeToPick:[],wavesCompleted:0},i)if(h=i.map&&!i.numWaves?i.map.length:i.numWaves||t,Array.isArray(i.waveSpacing))m=i.waveSpacing;else for(m=[],Array.isArray(i.waveSpacing)?(_numWaveThresholds=i.waveSpacing,h=-1):c=i.waveSpacing?i.waveSpacing:f,n=0;n<h;n++)m.push(c);else for(m=[],n=0;n<t;n++)m.push(f);P.init(i),_(l=new Z(-100,-100,null)),P.spawn(),A||(A=!0,x=this.update.bind(this),L&&window.cancelAnimationFrame(L),window.requestAnimationFrame(x))},update:function(t){let n,s,a,l=!1,h=e.length,c=Math.min((t-y)/1e3,.05);if(y=t,k)return Q.render(c),A=!1,void(L=window.requestAnimationFrame(x));for(a=0;a<h;a++)s=(n=e[a]).invisPointY-i/3,v&&n.update(c),n.y>=i?(o.push(n),n instanceof q&&!n.isFake&&w&&S()):n instanceof q&&n.y>=F&&!n.clicked&&r.indexOf(n)<0?r.push(n):n instanceof q&&!n.isFake&&n.y>=s&&n.y<n.invisPointY?n.sprite.alpha=1-(n.y-s)/(n.invisPointY-s):n instanceof q&&!n.isFake&&n.y>=n.invisPointY&&!n.clicked&&(n.sprite.draw=!1),n instanceof q&&!n.isFake&&n.y>=m[P.wavesPassed()]&&!n.triggeredWave&&(P.spawn(),n.triggeredWave=!0),v&&!w&&n instanceof q&&n.y>=g&&!n.triggeredPause&&(l=!0,n.triggeredPause=!0),E&&n instanceof U&&o.push(n);l&&(T(),S(),P.showTutorial(),W(),N.start()),E&&(E=!1),D(o),o.length=0,Q.render(c),window.requestAnimationFrame(x)},setGameOver:function(){k||(k=!0,d.textContent="TAP TO TRY AGAIN!",M(),a.wavesCompleted=P.wavesPassed()+1,console.log(a))},addScore:function(t){(R=(I+=t*B+R)%1)>0&&(I-=R)},toggleAcceleration:T,toggleInputBuffer:S,setInputEventFired:function(){E=!0},lanes:C,addEntity:_,clickZone:F,updateWavesPassed:P.updateWavesPassed,toggleInput:W,inputTimer:N,stoppingThreshold:g,inputEnabled:function(){return b},accelerating:function(){return v},inputBuffered:function(){return w},started:function(){return A},gameOver:function(){return k},entities:function(){return e},enemies:function(){return s},player:function(){return l},frontRowEnemies:function(){return r},score:function(){return I}}}();function tt(t){if(!$.started())return;let n,o,s,h,c=$.clickZone,d=null,u=$.frontRowEnemies(),p=$.player(),f=u.length,m=0,g=0;if("touchstart"===t.type?n=e.getRelativeEventCoords(t.changedTouches[0]):"mousedown"===t.type&&(n=e.getRelativeEventCoords(t)),a.inputType=t.type.substr(0,5),!$.gameOver()&&p&&$.inputEnabled()&&n.y>=c){for(l.x=n.x-r/2,l.y=$.stoppingThreshold,l.height=i-$.stoppingThreshold,s=0;s<f;s++)(m=(h=(o=u[s]).collisionRect()).intersection(l).getArea())>g&&(g=m,o.clicked=!0,d=o);g>0&&(a.selections.push(d.column),$.toggleInput(),K.putSpriteBack(d.sprite),d.isFake?(d.sprite=K.spr_bigX(),p.loseLife(),$.inputTimer.reset(!0),K.snd_error.play()):(d.sprite=K.spr_check(),p.addLife(),$.inputTimer.stop(),K.snd_valid.play()),$.setInputEventFired(),$.accelerating()?$.inputBuffered()||$.toggleInputBuffer():$.toggleAcceleration(),u.length=0,$.updateWavesPassed())}}Q.canvas.addEventListener("touchstart",function(t){"mousedown"===h?Date.now()-c>1e3&&(h=t.type,c=Date.now(),tt(t)):(h=t.type,c=Date.now(),tt(t))}),Q.canvas.addEventListener("mousedown",function(t){"touchstart"===h?Date.now()-c>1e3&&(h=t.type,c=Date.now(),tt(t)):(h=t.type,c=Date.now(),tt(t))}),document.body.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),window.addEventListener("load",function(){Q.render(),M()},!1),e.addResizeEvent(function(){let t,e;e=u.style.display,u.style.display="block",t=u.clientHeight,u.style.display=e,s=1.2*t,p.style.height=s+"px",p.style.width=s+"px",f.style.height=s+"px",f.style.width=s+"px"}),e.resize(),m.addEventListener("click",function(){N(y)},!1),v.addEventListener("click",function(){O(y)},!1),w.addEventListener("click",function(){H(y,B),C.firstElementChild.textContent="YES, RESTART",S=$.start},!1),E.addEventListener("click",function(){H(y,B),C.firstElementChild.textContent="YES, EXIT",S=_},!1),b.addEventListener("click",D,!1),k.addEventListener("click",function(){H(y,x)},!1),g.addEventListener("click",function(){N(x)},!1),I.addEventListener("click",W,!1),R.addEventListener("click",W,!1),L.addEventListener("click",function(){H(x,y)},!1),A.addEventListener("click",function(){H(F,y)},!1),C.addEventListener("click",function(){S(),O(B)},!1),P.addEventListener("click",function(){H(B,y)},!1);let et={};return et.initialize=$.start,et}();